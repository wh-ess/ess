(function(n,t){typeof define=="function"&&define.amd?define(t):typeof exports=="object"?module.exports=t():n.SVG=t()})(this,function(){function o(n){return n.toLowerCase().replace(/-(.)/g,function(n,t){return t.toUpperCase()})}function c(n){return n.length==4?["#",n.substring(1,2),n.substring(1,2),n.substring(2,3),n.substring(2,3),n.substring(3,4),n.substring(3,4)].join(""):n}function e(n){var t=n.toString(16);return t.length==1?"0"+t:t}function r(n,t,i){return(t==null||i==null)&&(i==null?i=n.height/n.width*t:t==null&&(t=n.width/n.height*i)),{width:t,height:i}}function u(t,i){return typeof t.from=="number"?t.from+(t.to-t.from)*i:t instanceof n.Color||t instanceof n.Number?t.at(i):i<1?t.from:t.to}function s(n){for(var t=0,r=n.length,i="";t<r;t++)i+=n[t][0],n[t][1]!=null&&(i+=n[t][1],n[t][2]!=null&&(i+=" ",i+=n[t][2],n[t][3]!=null&&(i+=" ",i+=n[t][3],i+=" ",i+=n[t][4],n[t][5]!=null&&(i+=" ",i+=n[t][5],i+=" ",i+=n[t][6],n[t][7]!=null&&(i+=" ",i+=n[t][7])))));return i+" "}function f(n){n.x2=n.x+n.width;n.y2=n.y+n.height;n.cx=n.x+n.width/2;n.cy=n.y+n.height/2}function h(n){if(n.matrix){var t=n.matrix.replace(/\s/g,"").split(",");t.length==6&&(n.a=parseFloat(t[0]),n.b=parseFloat(t[1]),n.c=parseFloat(t[2]),n.d=parseFloat(t[3]),n.e=parseFloat(t[4]),n.f=parseFloat(t[5]))}return n}function l(t){var i=t.toString().match(n.regex.reference);if(i)return i[1]}var n=this.SVG=function(t){if(n.supported)return t=new n.Doc(t),n.parser||n.prepare(t),t},i,t;return(n.ns="http://www.w3.org/2000/svg",n.xmlns="http://www.w3.org/2000/xmlns/",n.xlink="http://www.w3.org/1999/xlink",n.did=1e3,n.eid=function(t){return"Svgjs"+t.charAt(0).toUpperCase()+t.slice(1)+n.did++},n.create=function(n){var t=document.createElementNS(this.ns,n);return t.setAttribute("id",this.eid(n)),t},n.extend=function(){var t,r,u,i;for(t=[].slice.call(arguments),r=t.pop(),i=t.length-1;i>=0;i--)if(t[i])for(u in r)t[i].prototype[u]=r[u];n.Set&&n.Set.inherit&&n.Set.inherit()},n.prepare=function(t){var i=document.getElementsByTagName("body")[0],r=(i?new n.Doc(i):t.nested()).size(2,0),u=n.create("path");r.node.appendChild(u);n.parser={body:i||t.parent,draw:r.style("opacity:0;position:fixed;left:100%;top:100%;overflow:hidden"),poly:r.polyline().node,path:u}},n.supported=function(){return!!document.createElementNS&&!!document.createElementNS(n.ns,"svg").createSVGRect}(),!n.supported)?!1:(n.get=function(n){var t=document.getElementById(l(n)||n);if(t)return t.instance},n.invent=function(t){var i=typeof t.create=="function"?t.create:function(){this.constructor.call(this,n.create(t.create))};return t.inherit&&(i.prototype=new t.inherit),t.extend&&n.extend(i,t.extend),t.construct&&n.extend(t.parent||n.Container,t.construct),i},typeof i!="function"&&(i=function(n,t){t=t||{bubbles:!1,cancelable:!1,detail:undefined};var i=document.createEvent("CustomEvent");return i.initCustomEvent(n,t.bubbles,t.cancelable,t.detail),i},i.prototype=window.Event.prototype,window.CustomEvent=i),function(n){for(var r=0,i=["moz","webkit"],t=0;t<i.length&&!window.requestAnimationFrame;++t)n.requestAnimationFrame=n[i[t]+"RequestAnimationFrame"],n.cancelAnimationFrame=n[i[t]+"CancelAnimationFrame"]||n[i[t]+"CancelRequestAnimationFrame"];n.requestAnimationFrame=n.requestAnimationFrame||function(t){var i=(new Date).getTime(),u=Math.max(0,16-(i-r)),f=n.setTimeout(function(){t(i+u)},u);return r=i+u,f};n.cancelAnimationFrame=n.cancelAnimationFrame||n.clearTimeout}(window),n.regex={unit:/^(-?[\d\.]+)([a-z%]{0,2})$/,hex:/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i,rgb:/rgb\((\d+),(\d+),(\d+)\)/,reference:/#([a-z0-9\-_]+)/i,isHex:/^#[a-f0-9]{3,6}$/i,isRgb:/^rgb\(/,isCss:/[^:]+:[^;]+;?/,isBlank:/^(\s+)?$/,isNumber:/^-?[\d\.]+$/,isPercent:/^-?[\d\.]+%$/,isImage:/\.(jpg|jpeg|png|gif)(\?[^=]+.*)?/i,isEvent:/^[\w]+:[\w]+$/},n.defaults={matrix:"1 0 0 1 0 0",attrs:{"fill-opacity":1,"stroke-opacity":1,"stroke-width":0,"stroke-linejoin":"miter","stroke-linecap":"butt",fill:"#000000",stroke:"#000000",opacity:1,x:0,y:0,cx:0,cy:0,width:0,height:0,r:0,rx:0,ry:0,offset:0,"stop-opacity":1,"stop-color":"#000000","font-size":16,"font-family":"Helvetica, Arial, sans-serif","text-anchor":"start"},trans:function(){return{x:0,y:0,scaleX:1,scaleY:1,rotation:0,skewX:0,skewY:0,matrix:this.matrix,a:1,b:0,c:0,d:1,e:0,f:0}}},n.Color=function(t){var i;this.r=0;this.g=0;this.b=0;typeof t=="string"?n.regex.isRgb.test(t)?(i=n.regex.rgb.exec(t.replace(/\s/g,"")),this.r=parseInt(i[1]),this.g=parseInt(i[2]),this.b=parseInt(i[3])):n.regex.isHex.test(t)&&(i=n.regex.hex.exec(c(t)),this.r=parseInt(i[1],16),this.g=parseInt(i[2],16),this.b=parseInt(i[3],16)):typeof t=="object"&&(this.r=t.r,this.g=t.g,this.b=t.b)},n.extend(n.Color,{toString:function(){return this.toHex()},toHex:function(){return"#"+e(this.r)+e(this.g)+e(this.b)},toRgb:function(){return"rgb("+[this.r,this.g,this.b].join()+")"},brightness:function(){return this.r/255*.3+this.g/255*.59+this.b/255*.11},morph:function(t){return this.destination=new n.Color(t),this},at:function(t){return this.destination?(t=t<0?0:t>1?1:t,new n.Color({r:~~(this.r+(this.destination.r-this.r)*t),g:~~(this.g+(this.destination.g-this.g)*t),b:~~(this.b+(this.destination.b-this.b)*t)})):this}}),n.Color.test=function(t){return t+="",n.regex.isHex.test(t)||n.regex.isRgb.test(t)},n.Color.isRgb=function(n){return n&&typeof n.r=="number"&&typeof n.g=="number"&&typeof n.b=="number"},n.Color.isColor=function(t){return n.Color.isRgb(t)||n.Color.test(t)},n.Array=function(n,t){n=(n||[]).valueOf();n.length==0&&t&&(n=t.valueOf());this.value=this.parse(n)},n.extend(n.Array,{morph:function(n){if(this.destination=this.parse(n),this.value.length!=this.destination.length){for(var t=this.value[this.value.length-1],i=this.destination[this.destination.length-1];this.value.length>this.destination.length;)this.destination.push(i);while(this.value.length<this.destination.length)this.value.push(t)}return this},settle:function(){for(var n=0,i=this.value.length,t=[];n<i;n++)t.indexOf(this.value[n])==-1&&t.push(this.value[n]);return this.value=t},at:function(t){if(!this.destination)return this;for(var i=0,u=this.value.length,r=[];i<u;i++)r.push(this.value[i]+(this.destination[i]-this.value[i])*t);return new n.Array(r)},toString:function(){return this.value.join(" ")},valueOf:function(){return this.value},parse:function(n){return(n=n.valueOf(),Array.isArray(n))?n:this.split(n)},split:function(n){return n.replace(/\s+/g," ").replace(/^\s+|\s+$/g,"").split(" ")},reverse:function(){return this.value.reverse(),this}}),n.PointArray=function(){this.constructor.apply(this,arguments)},n.PointArray.prototype=new n.Array,n.extend(n.PointArray,{toString:function(){for(var n=0,i=this.value.length,t=[];n<i;n++)t.push(this.value[n].join(","));return t.join(" ")},at:function(t){if(!this.destination)return this;for(var i=0,u=this.value.length,r=[];i<u;i++)r.push([this.value[i][0]+(this.destination[i][0]-this.value[i][0])*t,this.value[i][1]+(this.destination[i][1]-this.value[i][1])*t]);return new n.PointArray(r)},parse:function(n){if(n=n.valueOf(),Array.isArray(n))return n;n=this.split(n);for(var t=0,u=n.length,i,r=[];t<u;t++)i=n[t].split(","),r.push([parseFloat(i[0]),parseFloat(i[1])]);return r},move:function(n,t){var r=this.bbox(),i;if(n-=r.x,t-=r.y,!isNaN(n)&&!isNaN(t))for(i=this.value.length-1;i>=0;i--)this.value[i]=[this.value[i][0]+n,this.value[i][1]+t];return this},size:function(n,t){for(var r=this.bbox(),i=this.value.length-1;i>=0;i--)this.value[i][0]=(this.value[i][0]-r.x)*n/r.width+r.x,this.value[i][1]=(this.value[i][1]-r.y)*t/r.height+r.y;return this},bbox:function(){return n.parser.poly.setAttribute("points",this.toString()),n.parser.poly.getBBox()}}),n.PathArray=function(n,t){this.constructor.call(this,n,t)},n.PathArray.prototype=new n.Array,n.extend(n.PathArray,{toString:function(){return s(this.value)},move:function(n,t){var u=this.bbox(),r,i;if(n-=u.x,t-=u.y,!isNaN(n)&&!isNaN(t))for(i=this.value.length-1;i>=0;i--)r=this.value[i][0],r=="M"||r=="L"||r=="T"?(this.value[i][1]+=n,this.value[i][2]+=t):r=="H"?this.value[i][1]+=n:r=="V"?this.value[i][1]+=t:r=="C"||r=="S"||r=="Q"?(this.value[i][1]+=n,this.value[i][2]+=t,this.value[i][3]+=n,this.value[i][4]+=t,r=="C"&&(this.value[i][5]+=n,this.value[i][6]+=t)):r=="A"&&(this.value[i][6]+=n,this.value[i][7]+=t);return this},size:function(n,t){for(var u,i=this.bbox(),r=this.value.length-1;r>=0;r--)u=this.value[r][0],u=="M"||u=="L"||u=="T"?(this.value[r][1]=(this.value[r][1]-i.x)*n/i.width+i.x,this.value[r][2]=(this.value[r][2]-i.y)*t/i.height+i.y):u=="H"?this.value[r][1]=(this.value[r][1]-i.x)*n/i.width+i.x:u=="V"?this.value[r][1]=(this.value[r][1]-i.y)*t/i.height+i.y:u=="C"||u=="S"||u=="Q"?(this.value[r][1]=(this.value[r][1]-i.x)*n/i.width+i.x,this.value[r][2]=(this.value[r][2]-i.y)*t/i.height+i.y,this.value[r][3]=(this.value[r][3]-i.x)*n/i.width+i.x,this.value[r][4]=(this.value[r][4]-i.y)*t/i.height+i.y,u=="C"&&(this.value[r][5]=(this.value[r][5]-i.x)*n/i.width+i.x,this.value[r][6]=(this.value[r][6]-i.y)*t/i.height+i.y)):u=="A"&&(this.value[r][1]=this.value[r][1]*n/i.width,this.value[r][2]=this.value[r][2]*t/i.height,this.value[r][6]=(this.value[r][6]-i.x)*n/i.width+i.x,this.value[r][7]=(this.value[r][7]-i.y)*t/i.height+i.y);return this},parse:function(t){if(t instanceof n.PathArray)return t.valueOf();var f,h,y,p,c,l,a,v,r,i,e,u=0,o=0;for(n.parser.path.setAttribute("d",typeof t=="string"?t:s(t)),e=n.parser.path.pathSegList,f=0,h=e.numberOfItems;f<h;++f)i=e.getItem(f),r=i.pathSegTypeAsLetter,r=="M"||r=="L"||r=="H"||r=="V"||r=="C"||r=="S"||r=="Q"||r=="T"||r=="A"?("x"in i&&(u=i.x),"y"in i&&(o=i.y)):("x1"in i&&(c=u+i.x1),"x2"in i&&(a=u+i.x2),"y1"in i&&(l=o+i.y1),"y2"in i&&(v=o+i.y2),"x"in i&&(u+=i.x),"y"in i&&(o+=i.y),r=="m"?e.replaceItem(n.parser.path.createSVGPathSegMovetoAbs(u,o),f):r=="l"?e.replaceItem(n.parser.path.createSVGPathSegLinetoAbs(u,o),f):r=="h"?e.replaceItem(n.parser.path.createSVGPathSegLinetoHorizontalAbs(u),f):r=="v"?e.replaceItem(n.parser.path.createSVGPathSegLinetoVerticalAbs(o),f):r=="c"?e.replaceItem(n.parser.path.createSVGPathSegCurvetoCubicAbs(u,o,c,l,a,v),f):r=="s"?e.replaceItem(n.parser.path.createSVGPathSegCurvetoCubicSmoothAbs(u,o,a,v),f):r=="q"?e.replaceItem(n.parser.path.createSVGPathSegCurvetoQuadraticAbs(u,o,c,l),f):r=="t"?e.replaceItem(n.parser.path.createSVGPathSegCurvetoQuadraticSmoothAbs(u,o),f):r=="a"?e.replaceItem(n.parser.path.createSVGPathSegArcAbs(u,o,i.r1,i.r2,i.angle,i.largeArcFlag,i.sweepFlag),f):(r=="z"||r=="Z")&&(u=y,o=p)),(r=="M"||r=="m")&&(y=u,p=o);for(t=[],e=n.parser.path.pathSegList,f=0,h=e.numberOfItems;f<h;++f)i=e.getItem(f),r=i.pathSegTypeAsLetter,u=[r],r=="M"||r=="L"||r=="T"?u.push(i.x,i.y):r=="H"?u.push(i.x):r=="V"?u.push(i.y):r=="C"?u.push(i.x1,i.y1,i.x2,i.y2,i.x,i.y):r=="S"?u.push(i.x2,i.y2,i.x,i.y):r=="Q"?u.push(i.x1,i.y1,i.x,i.y):r=="A"&&u.push(i.r1,i.r2,i.angle,i.largeArcFlag|0,i.sweepFlag|0,i.x,i.y),t.push(u);return t},bbox:function(){return n.parser.path.setAttribute("d",this.toString()),n.parser.path.getBBox()}}),n.Number=function(t){if(this.value=0,this.unit="",typeof t=="number")this.value=isNaN(t)?0:isFinite(t)?t:t<0?-34e37:34e37;else if(typeof t=="string"){var i=t.match(n.regex.unit);i&&(this.value=parseFloat(i[1]),i[2]=="%"?this.value/=100:i[2]=="s"&&(this.value*=1e3),this.unit=i[2])}else t instanceof n.Number&&(this.value=t.value,this.unit=t.unit)},n.extend(n.Number,{toString:function(){return(this.unit=="%"?~~(this.value*1e8)/1e6:this.unit=="s"?this.value/1e3:this.value)+this.unit},valueOf:function(){return this.value},plus:function(t){return this.value=this+new n.Number(t),this},minus:function(t){return this.plus(-new n.Number(t))},times:function(t){return this.value=this*new n.Number(t),this},divide:function(t){return this.value=this/new n.Number(t),this},to:function(n){return typeof n=="string"&&(this.unit=n),this},morph:function(t){return this.destination=new n.Number(t),this},at:function(t){return this.destination?new n.Number(this.destination).minus(this).times(t).plus(this):this}}),n.ViewBox=function(t){for(var o,s,h=1,c=1,l=t.bbox(),u=(t.attr("viewBox")||"").match(/-?[\d\.]+/g),f=t,e=t,i=new n.Number(t.width()),r=new n.Number(t.height());i.unit=="%";)h*=i.value,i=new n.Number(f instanceof n.Doc?f.parent.offsetWidth:f.parent.width()),f=f.parent;while(r.unit=="%")c*=r.value,r=new n.Number(e instanceof n.Doc?e.parent.offsetHeight:e.parent.height()),e=e.parent;this.x=l.x;this.y=l.y;this.width=i*h;this.height=r*c;this.zoom=1;u&&(o=parseFloat(u[0]),s=parseFloat(u[1]),i=parseFloat(u[2]),r=parseFloat(u[3]),this.zoom=this.width/this.height>i/r?this.height/r:this.width/i,this.x=o,this.y=s,this.width=i,this.height=r)},n.extend(n.ViewBox,{toString:function(){return this.x+" "+this.y+" "+this.width+" "+this.height}}),n.BBox=function(n){var t;if(this.x=0,this.y=0,this.width=0,this.height=0,n){try{t=n.node.getBBox()}catch(i){t={x:n.node.clientLeft,y:n.node.clientTop,width:n.node.clientWidth,height:n.node.clientHeight}}this.x=t.x+n.trans.x;this.y=t.y+n.trans.y;this.width=t.width*n.trans.scaleX;this.height=t.height*n.trans.scaleY}f(this)},n.extend(n.BBox,{merge:function(t){var i=new n.BBox;return i.x=Math.min(this.x,t.x),i.y=Math.min(this.y,t.y),i.width=Math.max(this.x+this.width,t.x+t.width)-i.x,i.height=Math.max(this.y+this.height,t.y+t.height)-i.y,f(i),i}}),n.RBox=function(n){var t,i,r={};if(this.x=0,this.y=0,this.width=0,this.height=0,n){for(t=n.doc().parent,i=n.doc().viewbox().zoom,r=n.node.getBoundingClientRect(),this.x=r.left,this.y=r.top,this.x-=t.offsetLeft,this.y-=t.offsetTop;t=t.offsetParent;)this.x-=t.offsetLeft,this.y-=t.offsetTop;for(t=n;t=t.parent;)t.type=="svg"&&t.viewbox&&(i*=t.viewbox().zoom,this.x-=t.x()||0,this.y-=t.y()||0)}this.x/=i;this.y/=i;this.width=r.width/=i;this.height=r.height/=i;this.x+=typeof scrollX=="number"?window.scrollX:window.pageXOffset;this.y+=typeof scrollY=="number"?window.scrollY:window.pageYOffset;f(this)},n.extend(n.RBox,{merge:function(t){var i=new n.RBox;return i.x=Math.min(this.x,t.x),i.y=Math.min(this.y,t.y),i.width=Math.max(this.x+this.width,t.x+t.width)-i.x,i.height=Math.max(this.y+this.height,t.y+t.height)-i.y,f(i),i}}),n.Element=n.invent({create:function(t){this._stroke=n.defaults.attrs.stroke;this.trans=n.defaults.trans();(this.node=t)&&(this.type=t.nodeName,this.node.instance=this)},extend:{x:function(t){return t!=null&&(t=new n.Number(t),t.value/=this.trans.scaleX),this.attr("x",t)},y:function(t){return t!=null&&(t=new n.Number(t),t.value/=this.trans.scaleY),this.attr("y",t)},cx:function(n){return n==null?this.x()+this.width()/2:this.x(n-this.width()/2)},cy:function(n){return n==null?this.y()+this.height()/2:this.y(n-this.height()/2)},move:function(n,t){return this.x(n).y(t)},center:function(n,t){return this.cx(n).cy(t)},width:function(n){return this.attr("width",n)},height:function(n){return this.attr("height",n)},size:function(t,i){var u=r(this.bbox(),t,i);return this.width(new n.Number(u.width)).height(new n.Number(u.height))},clone:function(){var t,i,n=this.type;return t=n=="rect"||n=="ellipse"?this.parent[n](0,0):n=="line"?this.parent[n](0,0,0,0):n=="image"?this.parent[n](this.src):n=="text"?this.parent[n](this.content):n=="path"?this.parent[n](this.attr("d")):n=="polyline"||n=="polygon"?this.parent[n](this.attr("points")):n=="g"?this.parent.group():this.parent[n](),i=this.attr(),delete i.id,t.attr(i),t.trans=this.trans,t.transform({})},remove:function(){return this.parent&&this.parent.removeElement(this),this},replace:function(n){return this.after(n).remove(),n},addTo:function(n){return n.put(this)},putIn:function(n){return n.add(this)},doc:function(t){return this._parent(t||n.Doc)},attr:function(t,i,r){if(t==null){for(t={},i=this.node.attributes,r=i.length-1;r>=0;r--)t[i[r].nodeName]=n.regex.isNumber.test(i[r].nodeValue)?parseFloat(i[r].nodeValue):i[r].nodeValue;return t}if(typeof t=="object")for(i in t)this.attr(i,t[i]);else if(i===null)this.node.removeAttribute(t);else{if(i==null)return i=this.node.attributes[t],i==null?n.defaults.attrs[t]:n.regex.isNumber.test(i.nodeValue)?parseFloat(i.nodeValue):i.nodeValue;if(t=="style")return this.style(i);t=="stroke-width"?this.attr("stroke",parseFloat(i)>0?this._stroke:null):t=="stroke"&&(this._stroke=i);(t=="fill"||t=="stroke")&&(n.regex.isImage.test(i)&&(i=this.doc().defs().image(i,0,0)),i instanceof n.Image&&(i=this.doc().defs().pattern(0,0,function(){this.add(i)})));typeof i=="number"?i=new n.Number(i):n.Color.isColor(i)?i=new n.Color(i):Array.isArray(i)&&(i=new n.Array(i));t=="leading"?this.leading&&this.leading(i):typeof r=="string"?this.node.setAttributeNS(r,t,i.toString()):this.node.setAttribute(t,i.toString());this.rebuild&&(t=="font-size"||t=="x")&&this.rebuild(t,i)}return this},transform:function(t,i){var r;if(arguments.length==0)return this.trans;if(typeof t=="string")return arguments.length<2?this.trans[t]:(r={},r[t]=i,this.transform(r));r=[];t=h(t);for(i in t)t[i]!=null&&(this.trans[i]=t[i]);return this.trans.matrix=this.trans.a+" "+this.trans.b+" "+this.trans.c+" "+this.trans.d+" "+this.trans.e+" "+this.trans.f,t=this.trans,t.matrix!=n.defaults.matrix&&r.push("matrix("+t.matrix+")"),t.rotation!=0&&r.push("rotate("+t.rotation+" "+(t.cx==null?this.bbox().cx:t.cx)+" "+(t.cy==null?this.bbox().cy:t.cy)+")"),(t.scaleX!=1||t.scaleY!=1)&&r.push("scale("+t.scaleX+" "+t.scaleY+")"),t.skewX!=0&&r.push("skewX("+t.skewX+")"),t.skewY!=0&&r.push("skewY("+t.skewY+")"),(t.x!=0||t.y!=0)&&r.push("translate("+new n.Number(t.x/t.scaleX)+" "+new n.Number(t.y/t.scaleY)+")"),r.length==0?this.node.removeAttribute("transform"):this.node.setAttribute("transform",r.join(" ")),this},style:function(t,i){if(arguments.length==0)return this.node.style.cssText||"";if(arguments.length<2)if(typeof t=="object")for(i in t)this.style(i,t[i]);else if(n.regex.isCss.test(t)){t=t.split(";");for(var r=0;r<t.length;r++)i=t[r].split(":"),this.style(i[0].replace(/\s+/g,""),i[1])}else return this.node.style[o(t)];else this.node.style[o(t)]=i===null||n.regex.isBlank.test(i)?"":i;return this},id:function(n){return this.attr("id",n)},bbox:function(){return new n.BBox(this)},rbox:function(){return new n.RBox(this)},inside:function(n,t){var i=this.bbox();return n>i.x&&t>i.y&&n<i.x+i.width&&t<i.y+i.height},show:function(){return this.style("display","")},hide:function(){return this.style("display","none")},visible:function(){return this.style("display")!="none"},toString:function(){return this.attr("id")},classes:function(){var n=this.node.getAttribute("class");return n===null?[]:n.trim().split(/\s+/)},hasClass:function(n){return this.classes().indexOf(n)!=-1},addClass:function(n){var t;return this.hasClass(n)||(t=this.classes(),t.push(n),this.node.setAttribute("class",t.join(" "))),this},removeClass:function(n){var t;return this.hasClass(n)&&(t=this.classes().filter(function(t){return t!=n}),this.node.setAttribute("class",t.join(" "))),this},toggleClass:function(n){return this.hasClass(n)?this.removeClass(n):this.addClass(n),this},reference:function(t){return n.get(this.attr()[t])},_parent:function(n){for(var t=this;t!=null&&!(t instanceof n);)t=t.parent;return t}}}),n.Parent=n.invent({create:function(n){this.constructor.call(this,n)},inherit:n.Element,extend:{children:function(){return this._children||(this._children=[])},add:function(n,t){return this.has(n)||(t=t==null?this.children().length:t,n.parent&&n.parent.children().splice(n.parent.index(n),1),this.children().splice(t,0,n),this.node.insertBefore(n.node,this.node.childNodes[t]||null),n.parent=this),this._defs&&(this.node.removeChild(this._defs.node),this.node.appendChild(this._defs.node)),this},put:function(n,t){return this.add(n,t),n},has:function(n){return this.index(n)>=0},index:function(n){return this.children().indexOf(n)},get:function(n){return this.children()[n]},first:function(){return this.children()[0]},last:function(){return this.children()[this.children().length-1]},each:function(t,i){for(var u=this.children(),r=0,f=u.length;r<f;r++)u[r]instanceof n.Element&&t.apply(u[r],[r,u]),i&&u[r]instanceof n.Container&&u[r].each(t,i);return this},removeElement:function(n){return this.children().splice(this.index(n),1),this.node.removeChild(n.node),n.parent=null,this},clear:function(){for(var n=this.children().length-1;n>=0;n--)this.removeElement(this.children()[n]);return this._defs&&this._defs.clear(),this},defs:function(){return this.doc().defs()}}}),n.Container=n.invent({create:function(n){this.constructor.call(this,n)},inherit:n.Parent,extend:{viewbox:function(t){return arguments.length==0?new n.ViewBox(this):(t=arguments.length==1?[t.x,t.y,t.width,t.height]:[].slice.call(arguments),this.attr("viewBox",t))}}}),n.FX=n.invent({create:function(n){this.target=n},extend:{animate:function(t,i,r){var o,s,h,c,e=this.target,f=this;return typeof t=="object"&&(r=t.delay,i=t.ease,t=t.duration),t=t=="="?t:t==null?1e3:new n.Number(t).valueOf(),i=i||"<>",f.to=function(n){var t,l,r;if(n=n<0?0:n>1?1:n,o==null){o=[];for(c in f.attrs)o.push(c);e.morphArray&&(f._plot||o.indexOf("points")>-1)&&(r=new e.morphArray(f._plot||f.attrs.points||e.array),f._size&&r.size(f._size.width.to,f._size.height.to),l=r.bbox(),f._x?r.move(f._x.to,l.y):f._cx&&r.move(f._cx.to-l.width/2,l.y),l=r.bbox(),f._y?r.move(l.x,f._y.to):f._cy&&r.move(l.x,f._cy.to-l.height/2),delete f._x,delete f._y,delete f._cx,delete f._cy,delete f._size,f._plot=e.array.morph(r))}if(s==null){s=[];for(c in f.trans)s.push(c)}if(h==null){h=[];for(c in f.styles)h.push(c)}for(n=i=="<>"?-Math.cos(n*Math.PI)/2+.5:i==">"?Math.sin(n*Math.PI/2):i=="<"?-Math.cos(n*Math.PI/2)+1:i=="-"?n:typeof i=="function"?i(n):n,f._plot?e.plot(f._plot.at(n)):(f._x?e.x(f._x.at(n)):f._cx&&e.cx(f._cx.at(n)),f._y?e.y(f._y.at(n)):f._cy&&e.cy(f._cy.at(n)),f._size&&e.size(f._size.width.at(n),f._size.height.at(n))),f._viewbox&&e.viewbox(f._viewbox.x.at(n),f._viewbox.y.at(n),f._viewbox.width.at(n),f._viewbox.height.at(n)),f._leading&&e.leading(f._leading.at(n)),t=o.length-1;t>=0;t--)e.attr(o[t],u(f.attrs[o[t]],n));for(t=s.length-1;t>=0;t--)e.transform(s[t],u(f.trans[s[t]],n));for(t=h.length-1;t>=0;t--)e.style(h[t],u(f.styles[h[t]],n));f._during&&f._during.call(e,n,function(t,i){return u({from:t,to:i},n)})},typeof t=="number"&&(this.timeout=setTimeout(function(){var u=(new Date).getTime();f.situation={interval:1e3/60,start:u,play:!0,finish:u+t,duration:t};f.render=function(){if(f.situation.play===!0){var u=(new Date).getTime(),o=u>f.situation.finish?1:(u-f.situation.start)/t;f.to(o);u>f.situation.finish?(f._plot&&e.plot(new n.PointArray(f._plot.destination).settle()),f._loop===!0||typeof f._loop=="number"&&f._loop>1?(typeof f._loop=="number"&&--f._loop,f.animate(t,i,r)):f._after?f._after.apply(e,[f]):f.stop()):f.animationFrame=requestAnimationFrame(f.render)}else f.animationFrame=requestAnimationFrame(f.render)};f.render()},new n.Number(r).valueOf())),this},bbox:function(){return this.target.bbox()},attr:function(t,i){var u,r;if(typeof t=="object")for(u in t)this.attr(u,t[u]);else r=this.target.attr(t),this.attrs[t]=n.Color.isColor(r)?new n.Color(r).morph(i):n.regex.unit.test(r)?new n.Number(r).morph(i):{from:r,to:i};return this},transform:function(n,t){if(arguments.length==1){n=h(n);delete n.matrix;this.target.trans.cx=n.cx||null;this.target.trans.cy=n.cy||null;delete n.cx;delete n.cy;for(t in n)this.trans[t]={from:this.target.trans[t],to:n[t]}}else{var i={};i[n]=t;this.transform(i)}return this},style:function(n,t){if(typeof n=="object")for(var i in n)this.style(i,n[i]);else this.styles[n]={from:this.target.style(n),to:t};return this},x:function(t){return this._x=new n.Number(this.target.x()).morph(t),this},y:function(t){return this._y=new n.Number(this.target.y()).morph(t),this},cx:function(t){return this._cx=new n.Number(this.target.cx()).morph(t),this},cy:function(t){return this._cy=new n.Number(this.target.cy()).morph(t),this},move:function(n,t){return this.x(n).y(t)},center:function(n,t){return this.cx(n).cy(t)},size:function(t,i){if(this.target instanceof n.Text)this.attr("font-size",t);else{var r=this.target.bbox();this._size={width:new n.Number(r.width).morph(t),height:new n.Number(r.height).morph(i)}}return this},plot:function(n){return this._plot=n,this},leading:function(t){return this.target._leading&&(this._leading=new n.Number(this.target._leading).morph(t)),this},viewbox:function(t,i,r,u){if(this.target instanceof n.Container){var f=this.target.viewbox();this._viewbox={x:new n.Number(f.x).morph(t),y:new n.Number(f.y).morph(i),width:new n.Number(f.width).morph(r),height:new n.Number(f.height).morph(u)}}return this},update:function(t){return this.target instanceof n.Stop&&(t.opacity!=null&&this.attr("stop-opacity",t.opacity),t.color!=null&&this.attr("stop-color",t.color),t.offset!=null&&this.attr("offset",new n.Number(t.offset))),this},during:function(n){return this._during=n,this},after:function(n){return this._after=n,this},loop:function(n){return this._loop=n||!0,this},stop:function(n){return n===!0?(this.animate(0),this._after&&this._after.apply(this.target,[this])):(clearTimeout(this.timeout),cancelAnimationFrame(this.animationFrame),this.attrs={},this.trans={},this.styles={},this.situation={},delete this._x,delete this._y,delete this._cx,delete this._cy,delete this._size,delete this._plot,delete this._loop,delete this._after,delete this._during,delete this._leading,delete this._viewbox),this},pause:function(){return this.situation.play===!0&&(this.situation.play=!1,this.situation.pause=(new Date).getTime()),this},play:function(){if(this.situation.play===!1){var n=(new Date).getTime()-this.situation.pause;this.situation.finish+=n;this.situation.start+=n;this.situation.play=!0}return this}},parent:n.Element,construct:{animate:function(t,i,r){return(this.fx||(this.fx=new n.FX(this))).stop().animate(t,i,r)},stop:function(n){return this.fx&&this.fx.stop(n),this},pause:function(){return this.fx&&this.fx.pause(),this},play:function(){return this.fx&&this.fx.play(),this}}}),n.extend(n.Element,n.FX,{dx:function(n){return this.x((this.target||this).x()+n)},dy:function(n){return this.y((this.target||this).y()+n)},dmove:function(n,t){return this.dx(n).dy(t)}}),["click","dblclick","mousedown","mouseup","mouseover","mouseout","mousemove","touchstart","touchmove","touchleave","touchend","touchcancel"].forEach(function(t){n.Element.prototype[t]=function(n){var i=this;return this.node["on"+t]=typeof n=="function"?function(){return n.apply(i,arguments)}:null,this}}),n.listeners=[],n.handlerMap=[],n.registerEvent=function(){},n.on=function(t,i,r){var o=r.bind(t.instance||t),u=(n.handlerMap.indexOf(t)+1||n.handlerMap.push(t))-1,f=i.split(".")[0],e=i.split(".")[1]||"*";n.listeners[u]=n.listeners[u]||{};n.listeners[u][f]=n.listeners[u][f]||{};n.listeners[u][f][e]=n.listeners[u][f][e]||{};n.listeners[u][f][e][r]=o;t.addEventListener(f,o,!1)},n.off=function(t,i,r){var f=n.handlerMap.indexOf(t),u=i&&i.split(".")[0],e=i&&i.split(".")[1];if(f!=-1)if(r)n.listeners[f][u]&&n.listeners[f][u][e||"*"]&&(t.removeEventListener(u,n.listeners[f][u][e||"*"][r],!1),delete n.listeners[f][u][e||"*"][r]);else if(e){if(n.listeners[f][u]&&n.listeners[f][u][e]){for(r in n.listeners[f][u][e])n.off(t,[u,e].join("."),r);delete n.listeners[f][u][e]}}else if(u){if(n.listeners[f][u]){for(namespace in n.listeners[f][u])n.off(t,[u,namespace].join("."));delete n.listeners[f][u]}}else{for(i in n.listeners[f])n.off(t,i);delete n.listeners[f]}},n.extend(n.Element,{on:function(t,i){n.on(this.node,t,i);return this},off:function(t,i){return n.off(this.node,t,i),this},fire:function(n,t){return this.node.dispatchEvent(new i(n,{detail:t})),this}}),n.Defs=n.invent({create:"defs",inherit:n.Container}),n.G=n.invent({create:"g",inherit:n.Container,extend:{x:function(n){return n==null?this.trans.x:this.transform("x",n)},y:function(n){return n==null?this.trans.y:this.transform("y",n)},cx:function(n){return n==null?this.bbox().cx:this.x(n-this.bbox().width/2)},cy:function(n){return n==null?this.bbox().cy:this.y(n-this.bbox().height/2)}},construct:{group:function(){return this.put(new n.G)}}}),n.extend(n.Element,{siblings:function(){return this.parent.children()},position:function(){return this.parent.index(this)},next:function(){return this.siblings()[this.position()+1]},previous:function(){return this.siblings()[this.position()-1]},forward:function(){var n=this.position();return this.parent.removeElement(this).put(this,n+1)},backward:function(){var n=this.position();return n>0&&this.parent.removeElement(this).add(this,n-1),this},front:function(){return this.parent.removeElement(this).put(this)},back:function(){return this.position()>0&&this.parent.removeElement(this).add(this,0),this},before:function(n){n.remove();var t=this.position();return this.parent.add(n,t),this},after:function(n){n.remove();var t=this.position();return this.parent.add(n,t+1),this}}),n.Mask=n.invent({create:function(){this.constructor.call(this,n.create("mask"));this.targets=[]},inherit:n.Container,extend:{remove:function(){for(var n=this.targets.length-1;n>=0;n--)this.targets[n]&&this.targets[n].unmask();return delete this.targets,this.parent.removeElement(this),this}},construct:{mask:function(){return this.defs().put(new n.Mask)}}}),n.extend(n.Element,{maskWith:function(t){return this.masker=t instanceof n.Mask?t:this.parent.mask().add(t),this.masker.targets.push(this),this.attr("mask",'url("#'+this.masker.attr("id")+'")')},unmask:function(){return delete this.masker,this.attr("mask",null)}}),n.Clip=n.invent({create:function(){this.constructor.call(this,n.create("clipPath"));this.targets=[]},inherit:n.Container,extend:{remove:function(){for(var n=this.targets.length-1;n>=0;n--)this.targets[n]&&this.targets[n].unclip();return delete this.targets,this.parent.removeElement(this),this}},construct:{clip:function(){return this.defs().put(new n.Clip)}}}),n.extend(n.Element,{clipWith:function(t){return this.clipper=t instanceof n.Clip?t:this.parent.clip().add(t),this.clipper.targets.push(this),this.attr("clip-path",'url("#'+this.clipper.attr("id")+'")')},unclip:function(){return delete this.clipper,this.attr("clip-path",null)}}),n.Gradient=n.invent({create:function(t){this.constructor.call(this,n.create(t+"Gradient"));this.type=t},inherit:n.Container,extend:{from:function(t,i){return this.type=="radial"?this.attr({fx:new n.Number(t),fy:new n.Number(i)}):this.attr({x1:new n.Number(t),y1:new n.Number(i)})},to:function(t,i){return this.type=="radial"?this.attr({cx:new n.Number(t),cy:new n.Number(i)}):this.attr({x2:new n.Number(t),y2:new n.Number(i)})},radius:function(t){return this.type=="radial"?this.attr({r:new n.Number(t)}):this},at:function(t,i,r){return this.put(new n.Stop).update(t,i,r)},update:function(n){return this.clear(),typeof n=="function"&&n.call(this,this),this},fill:function(){return"url(#"+this.id()+")"},toString:function(){return this.fill()}},construct:{gradient:function(n,t){return this.defs().gradient(n,t)}}}),n.extend(n.Defs,{gradient:function(t,i){return this.put(new n.Gradient(t)).update(i)}}),n.Stop=n.invent({create:"stop",inherit:n.Element,extend:{update:function(t){return(typeof t=="number"||t instanceof n.Number)&&(t={offset:arguments[0],color:arguments[1],opacity:arguments[2]}),t.opacity!=null&&this.attr("stop-opacity",t.opacity),t.color!=null&&this.attr("stop-color",t.color),t.offset!=null&&this.attr("offset",new n.Number(t.offset)),this}}}),n.Pattern=n.invent({create:"pattern",inherit:n.Container,extend:{fill:function(){return"url(#"+this.id()+")"},update:function(n){return this.clear(),typeof n=="function"&&n.call(this,this),this},toString:function(){return this.fill()}},construct:{pattern:function(n,t,i){return this.defs().pattern(n,t,i)}}}),n.extend(n.Defs,{pattern:function(t,i,r){return this.put(new n.Pattern).update(r).attr({x:0,y:0,width:t,height:i,patternUnits:"userSpaceOnUse"})}}),n.Doc=n.invent({create:function(t){this.parent=typeof t=="string"?document.getElementById(t):t;this.constructor.call(this,this.parent.nodeName=="svg"?this.parent:n.create("svg"));this.attr({xmlns:n.ns,version:"1.1",width:"100%",height:"100%"}).attr("xmlns:xlink",n.xlink,n.xmlns);this._defs=new n.Defs;this._defs.parent=this;this.node.appendChild(this._defs.node);this.doSpof=!1;this.parent!=this.node&&this.stage()},inherit:n.Container,extend:{stage:function(){var t=this;this.parent.appendChild(this.node);t.spof();n.on(window,"resize",function(){t.spof()});return this},defs:function(){return this._defs},spof:function(){if(this.doSpof){var n=this.node.getScreenCTM();n&&this.style("left",-n.e%1+"px").style("top",-n.f%1+"px")}return this},fixSubPixelOffset:function(){return this.doSpof=!0,this},remove:function(){return this.parent&&(this.parent.removeChild(this.node),this.parent=null),this}}}),n.Shape=n.invent({create:function(n){this.constructor.call(this,n)},inherit:n.Element}),n.Symbol=n.invent({create:"symbol",inherit:n.Container,construct:{symbol:function(){return this.defs().put(new n.Symbol)}}}),n.Use=n.invent({create:"use",inherit:n.Shape,extend:{element:function(t,i){return this.target=t,this.attr("href",(i||"")+"#"+t,n.xlink)}},construct:{use:function(t,i){return this.put(new n.Use).element(t,i)}}}),n.Rect=n.invent({create:"rect",inherit:n.Shape,construct:{rect:function(t,i){return this.put((new n.Rect).size(t,i))}}}),n.Ellipse=n.invent({create:"ellipse",inherit:n.Shape,extend:{x:function(n){return n==null?this.cx()-this.attr("rx"):this.cx(n+this.attr("rx"))},y:function(n){return n==null?this.cy()-this.attr("ry"):this.cy(n+this.attr("ry"))},cx:function(t){return t==null?this.attr("cx"):this.attr("cx",new n.Number(t).divide(this.trans.scaleX))},cy:function(t){return t==null?this.attr("cy"):this.attr("cy",new n.Number(t).divide(this.trans.scaleY))},width:function(t){return t==null?this.attr("rx")*2:this.attr("rx",new n.Number(t).divide(2))},height:function(t){return t==null?this.attr("ry")*2:this.attr("ry",new n.Number(t).divide(2))},size:function(t,i){var u=r(this.bbox(),t,i);return this.attr({rx:new n.Number(u.width).divide(2),ry:new n.Number(u.height).divide(2)})}},construct:{circle:function(n){return this.ellipse(n,n)},ellipse:function(t,i){return this.put(new n.Ellipse).size(t,i).move(0,0)}}}),n.Line=n.invent({create:"line",inherit:n.Shape,extend:{x:function(n){var t=this.bbox();return n==null?t.x:this.attr({x1:this.attr("x1")-t.x+n,x2:this.attr("x2")-t.x+n})},y:function(n){var t=this.bbox();return n==null?t.y:this.attr({y1:this.attr("y1")-t.y+n,y2:this.attr("y2")-t.y+n})},cx:function(n){var t=this.bbox().width/2;return n==null?this.x()+t:this.x(n-t)},cy:function(n){var t=this.bbox().height/2;return n==null?this.y()+t:this.y(n-t)},width:function(n){var t=this.bbox();return n==null?t.width:this.attr(this.attr("x1")<this.attr("x2")?"x2":"x1",t.x+n)},height:function(n){var t=this.bbox();return n==null?t.height:this.attr(this.attr("y1")<this.attr("y2")?"y2":"y1",t.y+n)},size:function(n,t){var i=r(this.bbox(),n,t);return this.width(i.width).height(i.height)},plot:function(n,t,i,r){return this.attr({x1:n,y1:t,x2:i,y2:r})}},construct:{line:function(t,i,r,u){return this.put((new n.Line).plot(t,i,r,u))}}}),n.Polyline=n.invent({create:"polyline",inherit:n.Shape,construct:{polyline:function(t){return this.put(new n.Polyline).plot(t)}}}),n.Polygon=n.invent({create:"polygon",inherit:n.Shape,construct:{polygon:function(t){return this.put(new n.Polygon).plot(t)}}}),n.extend(n.Polyline,n.Polygon,{morphArray:n.PointArray,plot:function(t){return this.attr("points",this.array=new n.PointArray(t,[[0,0]]))},move:function(n,t){return this.attr("points",this.array.move(n,t))},x:function(n){return n==null?this.bbox().x:this.move(n,this.bbox().y)},y:function(n){return n==null?this.bbox().y:this.move(this.bbox().x,n)},width:function(n){var t=this.bbox();return n==null?t.width:this.size(n,t.height)},height:function(n){var t=this.bbox();return n==null?t.height:this.size(t.width,n)},size:function(n,t){var i=r(this.bbox(),n,t);return this.attr("points",this.array.size(i.width,i.height))}}),n.Path=n.invent({create:"path",inherit:n.Shape,extend:{plot:function(t){return this.attr("d",this.array=new n.PathArray(t,[["M",0,0]]))},move:function(n,t){return this.attr("d",this.array.move(n,t))},x:function(n){return n==null?this.bbox().x:this.move(n,this.bbox().y)},y:function(n){return n==null?this.bbox().y:this.move(this.bbox().x,n)},size:function(n,t){var i=r(this.bbox(),n,t);return this.attr("d",this.array.size(i.width,i.height))},width:function(n){return n==null?this.bbox().width:this.size(n,this.bbox().height)},height:function(n){return n==null?this.bbox().height:this.size(this.bbox().width,n)}},construct:{path:function(t){return this.put(new n.Path).plot(t)}}}),n.Image=n.invent({create:"image",inherit:n.Shape,extend:{load:function(t){if(!t)return this;var i=this,r=document.createElement("img");return r.onload=function(){var u=i.doc(n.Pattern);i.width()==0&&i.height()==0&&i.size(r.width,r.height);u&&u.width()==0&&u.height()==0&&u.size(i.width(),i.height());typeof i._loaded=="function"&&i._loaded.call(i,{width:r.width,height:r.height,ratio:r.width/r.height,url:t})},this.attr("href",r.src=this.src=t,n.xlink)},loaded:function(n){return this._loaded=n,this}},construct:{image:function(t,i,r){return this.put(new n.Image).load(t).size(i||0,r||i||0)}}}),n.Text=n.invent({create:function(){this.constructor.call(this,n.create("text"));this._leading=new n.Number(1.3);this._rebuild=!0;this._build=!1;this.attr("font-family",n.defaults.attrs["font-family"])},inherit:n.Shape,extend:{x:function(n){return n==null?this.attr("x"):(this.textPath||this.lines.each(function(){this.newLined&&this.x(n)}),this.attr("x",n))},y:function(n){var t=this.attr("y"),i=typeof t=="number"?t-this.bbox().y:0;return n==null?typeof t=="number"?t-i:t:this.attr("y",typeof n=="number"?n+i:n)},cx:function(n){return n==null?this.bbox().cx:this.x(n-this.bbox().width/2)},cy:function(n){return n==null?this.bbox().cy:this.y(n-this.bbox().height/2)},text:function(n){if(typeof n=="undefined")return this.content;if(this.clear().build(!0),typeof n=="function")n.call(this,this);else{n=(this.content=n).split("\n");for(var t=0,i=n.length;t<i;t++)this.tspan(n[t]).newLine()}return this.build(!1).rebuild()},size:function(n){return this.attr("font-size",n).rebuild()},leading:function(t){return t==null?this._leading:(this._leading=new n.Number(t),this.rebuild())},rebuild:function(t){if(typeof t=="boolean"&&(this._rebuild=t),this._rebuild){var i=this;this.lines.each(function(){this.newLined&&(this.textPath||this.attr("x",i.attr("x")),this.attr("dy",i._leading*new n.Number(i.attr("font-size"))))});this.fire("rebuild")}return this},build:function(n){return this._build=!!n,this}},construct:{text:function(t){return this.put(new n.Text).text(t)},plain:function(t){return this.put(new n.Text).plain(t)}}}),n.TSpan=n.invent({create:"tspan",inherit:n.Shape,extend:{text:function(n){return typeof n=="function"?n.call(this,this):this.plain(n),this},dx:function(n){return this.attr("dx",n)},dy:function(n){return this.attr("dy",n)},newLine:function(){var t=this.doc(n.Text);return this.newLined=!0,this.dy(t._leading*t.attr("font-size")).attr("x",t.x())}}}),n.extend(n.Text,n.TSpan,{plain:function(n){return this._build===!1&&this.clear(),this.node.appendChild(document.createTextNode(this.content=n)),this},tspan:function(t){var r=(this.textPath||this).node,i=new n.TSpan;return this._build===!1&&this.clear(),r.appendChild(i.node),i.parent=this,this instanceof n.Text&&this.lines.add(i),i.text(t)},clear:function(){for(var t=(this.textPath||this).node;t.hasChildNodes();)t.removeChild(t.lastChild);return this instanceof n.Text&&(delete this.lines,this.lines=new n.Set,this.content=""),this},length:function(){return this.node.getComputedTextLength()}}),n.TextPath=n.invent({create:"textPath",inherit:n.Element,parent:n.Text,construct:{path:function(t){for(this.textPath=new n.TextPath;this.node.hasChildNodes();)this.textPath.node.appendChild(this.node.firstChild);return this.node.appendChild(this.textPath.node),this.track=this.doc().defs().path(t),this.textPath.parent=this,this.textPath.attr("href","#"+this.track,n.xlink),this},plot:function(n){return this.track&&this.track.plot(n),this}}}),n.Nested=n.invent({create:function(){this.constructor.call(this,n.create("svg"));this.style("overflow","visible")},inherit:n.Container,construct:{nested:function(){return this.put(new n.Nested)}}}),n.A=n.invent({create:"a",inherit:n.Container,extend:{to:function(t){return this.attr("href",t,n.xlink)},show:function(t){return this.attr("show",t,n.xlink)},target:function(n){return this.attr("target",n)}},construct:{link:function(t){return this.put(new n.A).to(t)}}}),n.extend(n.Element,{linkTo:function(t){var i=new n.A;return typeof t=="function"?t.call(i,i):i.to(t),this.parent.put(i).put(this)}}),n.Marker=n.invent({create:"marker",inherit:n.Container,extend:{width:function(n){return this.attr("markerWidth",n)},height:function(n){return this.attr("markerHeight",n)},ref:function(n,t){return this.attr("refX",n).attr("refY",t)},update:function(n){return this.clear(),typeof n=="function"&&n.call(this,this),this},toString:function(){return"url(#"+this.id()+")"}},construct:{marker:function(n,t,i){return this.defs().marker(n,t,i)}}}),n.extend(n.Defs,{marker:function(t,i,r){return this.put(new n.Marker).size(t,i).ref(t/2,i/2).viewbox(0,0,t,i).attr("orient","auto").update(r)}}),n.extend(n.Line,n.Polyline,n.Polygon,n.Path,{marker:function(t,i,r,u){var f=["marker"];return t!="all"&&f.push(t),f=f.join("-"),t=arguments[1]instanceof n.Marker?arguments[1]:this.doc().marker(i,r,u),this.attr(f,t)}}),t={stroke:["color","width","opacity","linecap","linejoin","miterlimit","dasharray","dashoffset"],fill:["color","opacity","rule"],prefix:function(n,t){return t=="color"?n:n+"-"+t}},["fill","stroke"].forEach(function(i){var r,u={};u[i]=function(u){if(typeof u=="string"||n.Color.isRgb(u)||u&&typeof u.fill=="function")this.attr(i,u);else for(r=t[i].length-1;r>=0;r--)u[t[i][r]]!=null&&this.attr(t.prefix(i,t[i][r]),u[t[i][r]]);return this};n.extend(n.Element,n.FX,u)}),n.extend(n.Element,n.FX,{rotate:function(n,t,i){return this.transform({rotation:n||0,cx:t,cy:i})},skew:function(n,t){return this.transform({skewX:n||0,skewY:t||0})},scale:function(n,t){return this.transform({scaleX:n,scaleY:t==null?n:t})},translate:function(n,t){return this.transform({x:n,y:t})},matrix:function(n){return this.transform({matrix:n})},opacity:function(n){return this.attr("opacity",n)}}),n.extend(n.Rect,n.Ellipse,n.FX,{radius:function(n,t){return this.attr({rx:n,ry:t||n})}}),n.extend(n.Path,{length:function(){return this.node.getTotalLength()},pointAt:function(n){return this.node.getPointAtLength(n)}}),n.extend(n.Parent,n.Text,n.FX,{font:function(n){for(var t in n)t=="leading"?this.leading(n[t]):t=="anchor"?this.attr("text-anchor",n[t]):t=="size"||t=="family"||t=="weight"||t=="stretch"||t=="variant"||t=="style"?this.attr("font-"+t,n[t]):this.attr(t,n[t]);return this}}),n.Set=n.invent({create:function(){this.clear()},extend:{add:function(){for(var i=[].slice.call(arguments),n=0,t=i.length;n<t;n++)this.members.push(i[n]);return this},remove:function(n){var t=this.index(n);return t>-1&&this.members.splice(t,1),this},each:function(n){for(var t=0,i=this.members.length;t<i;t++)n.apply(this.members[t],[t,this.members]);return this},clear:function(){return this.members=[],this},has:function(n){return this.index(n)>=0},index:function(n){return this.members.indexOf(n)},get:function(n){return this.members[n]},first:function(){return this.get(0)},last:function(){return this.get(this.members.length-1)},valueOf:function(){return this.members},bbox:function(){var t=new n.BBox,i;return this.members.length==0?t:(i=this.members[0].rbox(),t.x=i.x,t.y=i.y,t.width=i.width,t.height=i.height,this.each(function(){t=t.merge(this.rbox())}),t)}},construct:{set:function(){return new n.Set}}}),n.SetFX=n.invent({create:function(n){this.set=n}}),n.Set.inherit=function(){var i=[];for(var t in n.Shape.prototype)typeof n.Shape.prototype[t]=="function"&&typeof n.Set.prototype[t]!="function"&&i.push(t);i.forEach(function(t){n.Set.prototype[t]=function(){for(var i=0,r=this.members.length;i<r;i++)this.members[i]&&typeof this.members[i][t]=="function"&&this.members[i][t].apply(this.members[i],arguments);return t=="animate"?this.fx||(this.fx=new n.SetFX(this)):this}});i=[];for(t in n.FX.prototype)typeof n.FX.prototype[t]=="function"&&typeof n.SetFX.prototype[t]!="function"&&i.push(t);i.forEach(function(t){n.SetFX.prototype[t]=function(){for(var n=0,i=this.set.members.length;n<i;n++)this.set.members[n].fx[t].apply(this.set.members[n].fx,arguments);return this}})},n.extend(n.Element,{data:function(n,t,i){if(typeof n=="object")for(t in n)this.data(t,n[t]);else if(arguments.length<2)try{return JSON.parse(this.attr("data-"+n))}catch(r){return this.attr("data-"+n)}else this.attr("data-"+n,t===null?null:i===!0||typeof t=="string"||typeof t=="number"?t:JSON.stringify(t));return this}}),n.extend(n.Element,{remember:function(n,t){if(typeof arguments[0]=="object")for(var t in n)this.remember(t,n[t]);else{if(arguments.length==1)return this.memory()[n];this.memory()[n]=t}return this},forget:function(){if(arguments.length==0)this._memory={};else for(var n=arguments.length-1;n>=0;n--)delete this.memory()[arguments[n]];return this},memory:function(){return this._memory||(this._memory={})}}),n)}),function(){SVG.math={angle:function(n,t,i){if(i)return Math.abs(SVG.math.angle(n,i)-SVG.math.angle(t,i));for(var r=Math.atan2(t.y-n.y,t.x-n.x);r<0;)r+=2*Math.PI;return r},rad:function(n){return n*Math.PI/180},deg:function(n){return n*180/Math.PI},snapToAngle:function(n,t){var u=100,r,i,f;for(t.push(Math.min.apply(Math,t)+2*Math.PI),f=t.length;n>2*Math.PI;)n-=2*Math.PI;while(n<0)n+=2*Math.PI;for(i=0;i<f;i+=1){if(r=Math.abs(n-t[i]),r>u)return t[i-1];u=r}return t[0]},lerp:function(n,t,i){return n+i*(t-n)}};SVG.math.Point=function(n,t){this.x=n;this.y=t};SVG.math.Point.attr={stroke:"#000",fill:"none",radius:5};SVG.extend(SVG.math.Point,{draw:function(n,t){return n?(t=t||SVG.math.Point.attr,this.svg=n,this.circle=n.circle(t.radius).attr("cx",this.x).attr("cy",this.y).attr(t)):this.circle&&(this.circle.remove(),delete this.svg,delete this.circle),this}});SVG.math.Line=function(n,t){this.update(n,t)};SVG.math.Line.attr={stroke:"#000",fill:"none"};SVG.extend(SVG.math.Line,{update:function(n,t){return this.p1=n,this.p2=t,this.a=this.p2.y-this.p1.y,this.b=this.p1.x-this.p2.x,this.c=n.x*t.y-t.x*n.y,this},draw:function(n,t){return n?(attr=attr||SVG.math.Line.attr,this.svg=n,this.line=n.line(p1.x,p1.y,p2.x,p2.y).attr(t)):this.line&&(this.line.remove(),delete this.svg,delete this.line),this},parallel:function(n){return this.a*n.b-n.a*this.b==0},move:function(n,t,i){var r=n.x>t.x?-1:n.x<t.x?1:n.y>t.y?-1:1,u=Math.atan(Math.abs(this.p1.y-this.p2.y)/Math.abs(this.p1.x-this.p2.x)),f=i*Math.sin(u),e=i*Math.cos(u);return new SVG.math.Point(n.x+r*e,n.y+r*f)},intersection:function(n){var t=this.a*n.b-n.a*this.b;return{parallel:t===0,x:(n.b*this.c-this.b*n.c)/t,y:(this.a*n.c-n.a*this.c)/t}},midPoint:function(){return this.interpolatedPoint(.5)},segmentLengthSquared:function(){var n=this.p2.x-this.p1.x,t=this.p2.y-this.p1.y;return n*n+t*t},closestLinearInterpolation:function(n){var t=this.p2.x-this.p1.x,i=this.p2.y-this.p1.y;return((n.x-this.p1.x)*t+(n.y-this.p1.y)*i)/this.segmentLengthSquared()},interpolatedPoint:function(n){return{x:SVG.math.lerp(this.p1.x,this.p2.x,n),y:SVG.math.lerp(this.p1.y,this.p2.y,n)}},closestPoint:function(n){return this.interpolatedPoint(this.closestLinearInterpolation(n))},perpendicularLine:function(n,t){var i=this.p1.x-this.p2.x,r=this.p1.y-this.p2.y,u=Math.sqrt(i*i+r*r);return i=i/u,r=r/u,new SVG.math.Line(new SVG.math.Point(n.x+t*r,n.y-t*i),new SVG.math.Point(n.x-t*r,n.y+t*i))}})}(),function(){SVG.parse={attr:function(n){for(var r=n.attributes||[],i={},t=r.length-1;t>=0;t--)i[r[t].nodeName]=r[t].nodeValue;return typeof i.stroke!="undefined"&&typeof i["stroke-width"]=="undefined"&&(i["stroke-width"]=1),i},transform:function(n){for(var f,t,i={},e=(n||"").match(/[A-Za-z]+\([^\)]+\)/g)||[],r=SVG.defaults.trans(),u=e.length-1;u>=0;u--){f=e[u].match(/([A-Za-z]+)\(([^\)]+)\)/);t=(f[2]||"").replace(/^\s+/,"").replace(/,/g," ").replace(/\s+/g," ").split(" ");switch(f[1]){case"matrix":i.a=SVG.regex.isNumber.test(t[0])?parseFloat(t[0]):r.a;i.b=parseFloat(t[1])||r.b;i.c=parseFloat(t[2])||r.c;i.d=SVG.regex.isNumber.test(t[3])?parseFloat(t[3]):r.d;i.e=parseFloat(t[4])||r.e;i.f=parseFloat(t[5])||r.f;break;case"rotate":i.rotation=parseFloat(t[0])||r.rotation;i.cx=parseFloat(t[1])||r.cx;i.cy=parseFloat(t[2])||r.cy;break;case"scale":i.scaleX=SVG.regex.isNumber.test(t[0])?parseFloat(t[0]):r.scaleX;i.scaleY=SVG.regex.isNumber.test(t[1])?parseFloat(t[1]):r.scaleY;break;case"skewX":i.skewX=parseFloat(t[0])||r.skewX;break;case"skewY":i.skewY=parseFloat(t[0])||r.skewY;break;case"translate":i.x=parseFloat(t[0])||r.x;i.y=parseFloat(t[1])||r.y}}return i}}}(),function(){var n=Function.prototype.call.bind(Array.prototype.slice);SVG.extend(SVG.Path,{M:function(t){return(t=arguments.length===1?[t.x,t.y]:n(arguments),this.addSegment("M",t,this._redrawEnabled),this._segments.length===1)?this.plot("M"+t[0]+" "+t[1]):this},m:function(t){return(t=arguments.length===1?[t.x,t.y]:n(arguments),this.addSegment("m",t,this._redrawEnabled),this._segments.length===1)?this.plot("m"+t[0]+" "+t[1]):this},L:function(t){return t=arguments.length===1?[t.x,t.y]:n(arguments),this.addSegment("L",t,this._redrawEnabled)},l:function(t){return t=arguments.length===1?[t.x,t.y]:n(arguments),this.addSegment("l",t,this._redrawEnabled)},H:function(n){return this.addSegment("H",[n],this._redrawEnabled)},h:function(n){return this.addSegment("h",[n],this._redrawEnabled)},V:function(n){return this.addSegment("V",[n],this._redrawEnabled)},v:function(n){return this.addSegment("v",[n],this._redrawEnabled)},C:function(t,i,r){return r=arguments.length===3?[t.x,t.y,i.x,i.y,r.x,r.y]:n(arguments),this.addSegment("C",r,this._redrawEnabled)},c:function(t,i,r){return r=arguments.length===3?[t.x,t.y,i.x,i.y,r.x,r.y]:n(arguments),this.addSegment("c",r,this._redrawEnabled)},S:function(t,i){return i=arguments.length===2?[t.x,t.y,i.x,i.y]:n(arguments),this.addSegment("S",i,this._redrawEnabled)},s:function(t,i){return i=arguments.length===2?[t.x,t.y,i.x,i.y]:n(arguments),this.addSegment("s",i,this._redrawEnabled)},Q:function(t,i){return i=arguments.length===2?[t.x,t.y,i.x,i.y]:n(arguments),this.addSegment("Q",i,this._redrawEnabled)},q:function(t,i){return i=arguments.length===2?[t.x,t.y,i.x,i.y]:n(arguments),this.addSegment("q",i,this._redrawEnabled)},T:function(t){return t=arguments.length===1?[t.x,t.y]:n(arguments),this.addSegment("T",t,this._redrawEnabled)},t:function(t){return t=arguments.length===1?[t.x,t.y]:n(arguments),this.addSegment("t",t,this._redrawEnabled)},A:function(t,i,r,u,f,e){return e=arguments.length===6?[t,i,r,u,f,e.x,e.y]:n(arguments),this.addSegment("A",e,this._redrawEnabled)},a:function(t,i,r,u,f,e){return e=arguments.length===6?[t,i,r,u,f,e.x,e.y]:n(arguments),this.addSegment("a",e,this._redrawEnabled)},Z:function(){return this.addSegment("Z",[],this._redrawEnabled)},addSegment:function(n,t,i){var r={type:n,coords:t};return this._segments||(this._segments=[]),this._segments.push(r),i!==!1&&this._drawSegment(r),this},clear:function(){return this._segments&&(this._segments.length=0),this._lastSegment=null,this.plot()},getSegmentCount:function(){return this._segments.length},getSegment:function(n){return this._segments[n]},removeSegment:function(n){return this._segments.splice(n,1),this.redraw()},replaceSegment:function(n,t){return this._segments.splice(n,1,t),this.redraw()},drawAnimated:function(n){var t,i;return n=n||{},n.duration=n.duration||"1000",n.easing=n.easing||"<>",n.delay=n.delay||0,t=this.length(),this.stroke({width:2,dasharray:t+" "+t,dashoffset:t}),i=this.animate(n.duration,n.easing,n.delay),i.stroke({dashoffset:0}),this},update:function(n){return n===!0&&(this._redrawEnabled=!1),n===!1&&(this._redrawEnabled=!0),!!this._redrawEnabled},redraw:function(){return this._lastSegment=null,this.attr("d",""),this._drawSegment(this._segments)},_drawSegment:function(n){var r="",i=this._lastSegment,t;for(Array.isArray(n)||(n=[n]),t=0;t<n.length;t+=1)r+=i===n[t].type?" "+n[t].coords.join(" "):" "+n[t].type+n[t].coords.join(" "),i=n[t].type;return this._lastSegment=i,this.attr("d",(this.attr("d")||"")+r)}})}.call(this),function(){SVG.extend(SVG.Element,{draggy:function(n){function f(n){var r,i,t;return!n||typeof n.transform!="function"?{x:1,y:1}:(r=n.parent,i=n.transform(),t={},t=f(r),{x:i.scaleX*t.x,y:i.scaleY*t.y})}var u,i,r,t=this;typeof this.fixed=="function"&&this.fixed();n=n||{};u=function(n){var f=this.parent._parent(SVG.Nested)||this._parent(SVG.Doc),u;n=n||window.event;t.beforedrag&&t.beforedrag(n);u=t.bbox();t instanceof SVG.G?(u.x=t.x(),u.y=t.y()):t instanceof SVG.Nested&&(u={x:t.x(),y:t.y(),width:t.width(),height:t.height()});t.startEvent=n;t.startPosition={x:u.x,y:u.y,width:u.width,height:u.height,zoom:f.viewbox().zoom,rotation:t.transform("rotation")*Math.PI/180};SVG.on(window,"mousemove",i);SVG.on(window,"touchmove",i);SVG.on(window,"mouseup",r);SVG.on(window,"touchend",r);t.node.dispatchEvent(new CustomEvent("dragstart",{detail:{event:n,delta:{x:0,y:0}}}));n.preventDefault?n.preventDefault():n.returnValue=!1};i=function(i){var o;if(i=i||window.event,t.startEvent){var r,u,s=t.startPosition.rotation,h=t.startPosition.width,c=t.startPosition.height,e={x:i.pageX-t.startEvent.pageX,y:i.pageY-t.startEvent.pageY};/^touchstart|touchmove$/.test(i.type)?(e.x=i.touches[0].pageX-t.startEvent.touches[0].pageX,e.y=i.touches[0].pageY-t.startEvent.touches[0].pageY):/^click|mousedown|mousemove$/.test(i.type)&&(e.x=i.pageX-t.startEvent.pageX,e.y=i.pageY-t.startEvent.pageY);e.scale=f(t);r=t.startPosition.x+(e.x*Math.cos(s)+e.y*Math.sin(s))/Math.pow(e.scale.x,2);u=t.startPosition.y+(e.y*Math.cos(s)+e.x*Math.sin(-s))/Math.pow(e.scale.y,2);typeof n=="function"?(o=n(r,u),typeof o=="object"?(typeof o.x!="boolean"||o.x?(r=typeof o.x=="number"?o.x:r,t.x(r)):r=t.x(),typeof o.y!="boolean"||o.y?(u=typeof o.y=="number"?o.y:u,t.y(u)):u=t.y()):typeof o=="boolean"&&o?t.move(r,u):(r=t.x(),u=t.y())):typeof n=="object"&&(n.minX!==null&&r<n.minX?r=n.minX:n.maxX!==null&&r>n.maxX-h&&(r=n.maxX-h),n.minY!==null&&u<n.minY?u=n.minY:n.maxY!==null&&u>n.maxY-c&&(u=n.maxY-c),t.move(r,u));e.movedX=r-t.startPosition.x;e.movedY=u-t.startPosition.y;t.node.dispatchEvent(new CustomEvent("dragmove",{detail:{delta:e,event:i}}))}};r=function(n){n=n||window.event;var u={x:n.pageX-t.startEvent.pageX,y:n.pageY-t.startEvent.pageY,zoom:t.startPosition.zoom};t.startEvent=null;t.startPosition=null;SVG.off(window,"mousemove",i);SVG.off(window,"touchmove",i);SVG.off(window,"mouseup",r);SVG.off(window,"touchend",r);t.node.dispatchEvent(new CustomEvent("dragend",{detail:{delta:{x:0,y:0},event:n}}))};t.on("mousedown",u);t.on("touchstart",u);return t.fixed=function(){return t.off("mousedown",u),t.off("touchstart",u),SVG.off(window,"mousemove",i),SVG.off(window,"touchmove",i),SVG.off(window,"mouseup",r),SVG.off(window,"touchend",r),u=i=r=null,t},this}})}.call(this);
/*!
 * SVG.js Connectable Plugin
 * =========================
 *
 * A JavaScript library for connecting SVG things.
 * Created with <3 and JavaScript by the jillix developers.
 *
 * svg.connectable.js 1.0.1
 * Licensed under the MIT license.
 * */
(function(){function i(i,r){var u={},f,h,c;r===undefined&&(r=i,i={});n=i.container||n;f=this;t=i.markers||t;var e=t.marker(10,10),o="triangle-"+Math.random().toString(16),s=n.line().attr("marker-end","url(#"+o+")");e.attr({id:o,viewBox:"0 0 10 10",refX:"0",refY:"5",markerUnits:"strokeWidth",markerWidth:"4",markerHeight:"5"});e.path().attr({d:"M 0 0 L 10 5 L 0 10 z"});h={};c={};u.source=f;u.target=r;u.line=s;u.marker=e;u.computeLineCoordinates=function(n){var t=n.source.bbox(),i=n.target.bbox(),r=t.x+t.width/2,u=t.y+t.height/2,f=i.x+i.width/2,e=i.y+i.height/2;return{x1:r,y1:u,x2:f,y2:e}};i.padEllipse&&(u.computeLineCoordinates=function(n){var c=n.source.transform(),l=n.target.transform(),i=parseFloat(n.source.node.querySelector("ellipse").getAttribute("rx")),r=parseFloat(n.source.node.querySelector("ellipse").getAttribute("ry")),u=parseFloat(n.target.node.querySelector("ellipse").getAttribute("rx")),f=parseFloat(n.target.node.querySelector("ellipse").getAttribute("ry")),e=c.x+i/2,o=c.y+r/2,y=l.x+u/2,p=l.y+f/2,s=y-e,h=p-o,t=Math.sqrt(s*s+h*h),a=s/t,v=h/t,w=e+i*a,b=o+r*v,k=e+(t-u-5)*a,d=o+(t-f-5)*v;return{x1:w+i/2,y1:b+r/2,x2:k+u/2,y2:d+f/2}});f.cons=f.cons||[];f.cons.push(u);u.update=function(){s.attr(u.computeLineCoordinates(u))};u.update();f.on("dragmove",u.update);r.on("dragmove",u.update);return u.setLineColor=function(n,t){t=t||this;t.line.stroke(n);t.marker.fill(n)},u}var n=null,t=null;SVG.extend(SVG.Element,{connectable:i})}).call(this),function(){SVG.Absorbee=SVG.invent({create:function(n){this.node=n;this.type=n.localName;this.node.instance=this},inherit:SVG.Element,construct:{absorb:function(n){if(typeof n=="string"){var t,i=document.createElement("div");for(n=n.replace(/\n/,"").replace(/<(\w+)([^<]+?)\/>/g,"<$1$2><\/$1>"),i.innerHTML='<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">'+n+"<\/svg>",t=i.firstChild.childNodes.length-1;t>=0;t--)i.firstChild.childNodes[t].nodeType==1&&this.add(new SVG.Absorbee(i.firstChild.childNodes[t]),0);i=null}else this.add(new SVG.Absorbee(n));return this}}})}.call(this);
/*! svg.draw.js - v1.0.0 - 2015-05-25
* https://github.com/Fuzzyma/svg.draw.js
* Copyright (c) 2015 Ulrich-Matthias Schäfer; Licensed MIT */
(function(){function t(n){var t=0,i=0,r;for(("doc"in n)&&(r=n.bbox(),t=r.x,i=r.y,n=n.doc().parent);n.nodeName.toUpperCase()!=="BODY";)t+=n.offsetLeft,i+=n.offsetTop,n=n.offsetParent;return{x:t,y:i}}function n(n,t,i){var u=this,r;n.remember("_paintHandler",this);this.el=n;this.parent=n.parent._parent(SVG.Nested)||n._parent(SVG.Doc);this.set=this.parent.set();this.parameters={};this.event=t;this.plugin=this.getPlugin();this.options={};for(r in this.el.draw.defaults)this.options[r]=this.el.draw.defaults[r],typeof i[r]!="undefined"&&(this.options[r]=i[r]);if(!t)this.parent.on("click.draw",function(n){u.start(n||window.event)})}n.prototype.start=function(n){this.parameters={x:n.pageX,y:n.pageY,offset:t(this.parent)};var i={},r=this.el,u=this;switch(r.type){case"rect":i={x:n.pageX,y:n.pageY,height:1,width:1};r.attr(i);this.calc=function(n){i.x=this.parameters.x;i.y=this.parameters.y;i.height=n.pageY-i.y;i.width=n.pageX-i.x;i.x-=this.parameters.offset.x;i.y-=this.parameters.offset.y;this.snapToGrid(i);i.width<1&&(i.x=i.x+i.width,i.width=-i.width);i.height<1&&(i.y=i.y+i.height,i.height=-i.height);r.attr(i)};break;case"line":this.calc=function(n){i.x1=this.parameters.x-this.parameters.offset.x;i.y1=this.parameters.y-this.parameters.offset.y;i.x2=n.pageX-this.parameters.offset.x;i.y2=n.pageY-this.parameters.offset.y;this.snapToGrid(i);r.attr(i)};break;case"polyline":case"polygon":r.array.value[0]=this.snapToGrid([n.pageX-this.parameters.offset.x,n.pageY-this.parameters.offset.y]);r.array.value[1]=this.snapToGrid([n.pageX-this.parameters.offset.x,n.pageY-this.parameters.offset.y]);r.plot(r.array);this.drawCircles(r.array.value);this.calc=function(n){r.array.value.pop();n&&r.array.value.push(this.snapToGrid([n.pageX-this.parameters.offset.x,n.pageY-this.parameters.offset.y]));r.plot(r.array)};break;case"ellipse":i={cx:n.pageX,cy:n.pageY,rx:1,ry:1};this.snapToGrid(i);r.attr(i);this.calc=this.options.useRadius?function(n){i.cx=this.parameters.x-this.parameters.offset.x;i.cy=this.parameters.y-this.parameters.offset.y;i.rx=i.ry=Math.sqrt((n.pageX-this.parameters.x)*(n.pageX-this.parameters.x)+(n.pageY-this.parameters.y)*(n.pageY-this.parameters.y));this.snapToGrid(i);r.attr(i)}:function(n){i.cx=this.parameters.x-this.parameters.offset.x;i.cy=this.parameters.y-this.parameters.offset.y;i.rx=Math.abs(n.pageX-this.parameters.x);i.ry=Math.abs(n.pageY-this.parameters.y);this.snapToGrid(i);r.attr(i)};break;default:if(this.plugin)this.plugin.init.call(this,n),this.calc=this.plugin.calc;else return}r.fire("drawstart",[n.pageX-this.parameters.offset.x,n.pageY-this.parameters.offset.y]);SVG.on(window,"mousemove.draw",function(n){u.update(n||window.event)});this.start=this.point};n.prototype.point=function(n){if(this.plugin&&this.plugin.point){this.plugin.point.call(this,n);return}if(this.el.type.indexOf("poly")>-1){var t=[n.pageX-this.parameters.offset.x,n.pageY-this.parameters.offset.y];this.el.array.value.push(this.snapToGrid(t));this.el.plot(this.el.array);this.drawCircles(this.el.array.value);this.el.fire("drawpoint",t);return}this.stop(n)};n.prototype.stop=function(n){n&&this.update(n);this.set.each(function(){this.remove()});SVG.off(window,"mousemove.draw");this.parent.off("click.draw");this.el.forget("_paintHandler");this.el.draw=function(){};this.el.fire("drawstop")};n.prototype.update=function(n){var t=[n.pageX-this.parameters.offset.x,n.pageY-this.parameters.offset.y];this.calc(n);this.el.fire("drawupdate",t)};n.prototype.done=function(){this.calc();this.stop();this.el.fire("drawdone")};n.prototype.cancel=function(){this.stop();this.el.remove();this.el.fire("drawcancel")};n.prototype.drawCircles=function(n){this.set.each(function(){this.remove()});this.set.clear();for(var t=0;t<n.length;++t)this.set.add(this.parent.circle(5).stroke({width:1}).fill("#ccc").center(n[t][0],n[t][1]))};n.prototype.snapToGrid=function(n){var t=null,i;if(n.length)return t=[n[0]%this.options.snapToGrid,n[1]%this.options.snapToGrid],n[0]-=t[0]<this.options.snapToGrid/2?t[0]:t[0]-this.options.snapToGrid,n[1]-=t[1]<this.options.snapToGrid/2?t[1]:t[1]-this.options.snapToGrid,n;for(i in n)t=n[i]%this.options.snapToGrid,n[i]-=(t<this.options.snapToGrid/2?t:t-this.options.snapToGrid)+(t<0?this.options.snapToGrid:0);return n};n.prototype.param=function(n,t){this.options[n]=t===null?this.el.draw.defaults[n]:t};n.prototype.getPlugin=function(){return this.el.draw.plugins[this.el.type]};SVG.extend(SVG.Element,{draw:function(t,i,r){t instanceof Event||typeof t=="string"||(i=t,t=null);var u=this.remember("_paintHandler")||new n(this,t,i||{});return t instanceof Event&&u.start(t),u[t]&&u[t](i,r),this}});SVG.Element.prototype.draw.defaults={useRadius:!1,snapToGrid:1};SVG.Element.prototype.draw.plugins={}}).call(this);SVG.easing={quadIn:function(n){return Math.pow(n,2)},quadOut:function(n){return-(Math.pow(n-1,2)-1)},quadInOut:function(n){return(n/=.5)<1?.5*Math.pow(n,2):-.5*((n-=2)*n-2)},cubicIn:function(n){return Math.pow(n,3)},cubicOut:function(n){return Math.pow(n-1,3)+1},cubicInOut:function(n){return(n/=.5)<1?.5*Math.pow(n,3):.5*(Math.pow(n-2,3)+2)},quartIn:function(n){return Math.pow(n,4)},quartOut:function(n){return-(Math.pow(n-1,4)-1)},quartInOut:function(n){return(n/=.5)<1?.5*Math.pow(n,4):-.5*((n-=2)*Math.pow(n,3)-2)},quintIn:function(n){return Math.pow(n,5)},quintOut:function(n){return Math.pow(n-1,5)+1},quintInOut:function(n){return(n/=.5)<1?.5*Math.pow(n,5):.5*(Math.pow(n-2,5)+2)},sineIn:function(n){return-Math.cos(n*(Math.PI/2))+1},sineOut:function(n){return Math.sin(n*(Math.PI/2))},sineInOut:function(n){return-.5*(Math.cos(Math.PI*n)-1)},expoIn:function(n){return n==0?0:Math.pow(2,10*(n-1))},expoOut:function(n){return n==1?1:-Math.pow(2,-10*n)+1},expoInOut:function(n){return n==0?0:n==1?1:(n/=.5)<1?.5*Math.pow(2,10*(n-1)):.5*(-Math.pow(2,-10*--n)+2)},circIn:function(n){return-(Math.sqrt(1-n*n)-1)},circOut:function(n){return Math.sqrt(1-Math.pow(n-1,2))},circInOut:function(n){return(n/=.5)<1?-.5*(Math.sqrt(1-n*n)-1):.5*(Math.sqrt(1-(n-=2)*n)+1)},backIn:function(n){var t=1.70158;return n*n*((t+1)*n-t)},backOut:function(n){n=n-1;var t=1.70158;return n*n*((t+1)*n+t)+1},backInOut:function(n){var t=1.70158;return(n/=.5)<1?.5*n*n*(((t*=1.525)+1)*n-t):.5*((n-=2)*n*(((t*=1.525)+1)*n+t)+2)},swingFromTo:function(n){var t=1.70158;return(n/=.5)<1?.5*n*n*(((t*=1.525)+1)*n-t):.5*((n-=2)*n*(((t*=1.525)+1)*n+t)+2)},swingFrom:function(n){var t=1.70158;return n*n*((t+1)*n-t)},swingTo:function(n){var t=1.70158;return(n-=1)*n*((t+1)*n+t)+1},bounce:function(n){var r=7.5625,t=2.75,i;return n<1/t?i=r*n*n:n<2/t?(n-=1.5/t,i=r*n*n+.75):n<2.5/t?(n-=2.25/t,i=r*n*n+.9375):(n-=2.625/t,i=r*n*n+.984375),i},bounceOut:function(n){return n<1/2.75?7.5625*n*n:n<2/2.75?7.5625*(n-=1.5/2.75)*n+.75:n<2.5/2.75?7.5625*(n-=2.25/2.75)*n+.9375:7.5625*(n-=2.625/2.75)*n+.984375},elastic:function(n){return n==!!n?n:Math.pow(2,-10*n)*Math.sin((n-.075)*2*Math.PI/.3)+1}},function(){function n(n,t,r){if(t){var u="",f=t===!0?"  ":t||"";for(i=r-1;i>=0;i--)u+=f;n=u+n+"\n"}return n}SVG.extend(SVG.Element,{exportSvg:function(t,i){var r,f,o,s,e,h,c=this.node.nodeName,u="";if(t=t||{},t.exclude==null||!t.exclude.call(this)){if(t=t||{},i=i||0,this instanceof SVG.Doc&&(u+=n('<?xml version="1.0" encoding="UTF-8"?>',t.whitespace,i),o=this.attr("width"),s=this.attr("height"),t.width&&this.attr("width",t.width),t.height&&this.attr("height",t.height)),u+=n("<"+c+this.attrToString()+">",t.whitespace,i),this instanceof SVG.Doc&&(this.attr({width:o,height:s}),u+=n("<desc>Created with svg.js [http://svgjs.com]<\/desc>",t.whitespace,i+1),u+=this.defs().exportSvg(t,i+1)),this instanceof SVG.Parent)for(r=0,f=this.children().length;r<f;r++)SVG.Absorbee&&this.children()[r]instanceof SVG.Absorbee?(h=this.children()[r].node.cloneNode(!0),e=document.createElement("div"),e.appendChild(h),u+=e.innerHTML):u+=this.children()[r].exportSvg(t,i+1);else if(this instanceof SVG.Text||this instanceof SVG.TSpan)for(r=0,f=this.node.childNodes.length;r<f;r++)u+=this.node.childNodes[r].instance instanceof SVG.TSpan?this.node.childNodes[r].instance.exportSvg(t,i+1):this.node.childNodes[r].nodeValue.replace(/&/g,"&amp;");else SVG.ComponentTransferEffect&&this instanceof SVG.ComponentTransferEffect&&this.rgb.each(function(){u+=this.exportSvg(t,i+1)});u+=n("<\/"+c+">",t.whitespace,i)}return u},exportAttr:function(n){return arguments.length==0?this.data("svg-export-attr"):this.data("svg-export-attr",n)},attrToString:function(){var n,t,r=[],u=this.exportAttr(),i=this.attr();if(typeof u=="object")for(n in u)n!="data-svg-export-attr"&&(i[n]=u[n]);for(n in i)t=i[n],n=="xlink"?n="xmlns:xlink":n=="href"&&(i["xlink:href"]||(n="xlink:href")),typeof t=="string"&&(t=t.replace(/"/g,"'")),n!="data-svg-export-attr"&&n!="href"&&(n!="stroke"||parseFloat(i["stroke-width"])>0)&&r.push(n+'="'+t+'"');return r.length?" "+r.join(" "):""}})}.call(this),function(){function t(n){return Array.isArray(n)&&(n=new SVG.Array(n)),n.toString().replace(/^\s+/,"").replace(/\s+$/,"").replace(/\s+/g," ")}function i(n){if(!Array.isArray(n))return n;for(var t=0,r=n.length,i=[];t<r;t++)i.push(n[t]);return i.join(" ")}SVG.Filter=function(){this.constructor.call(this,SVG.create("filter"))};SVG.Filter.prototype=new SVG.Parent;SVG.extend(SVG.Filter,{source:"SourceGraphic",sourceAlpha:"SourceAlpha",background:"BackgroundImage",backgroundAlpha:"BackgroundAlpha",fill:"FillPaint",stroke:"StrokePaint",put:function(n,t){return this.add(n,t),n.attr({"in":this.source,result:n})},blend:function(n,t,i){return this.put(new SVG.BlendEffect).attr({"in":n,in2:t,mode:i||"normal"})},colorMatrix:function(n,i){return n=="matrix"&&(i=t(i)),this.put(new SVG.ColorMatrixEffect).attr({type:n,values:typeof i=="undefined"?null:i})},convolveMatrix:function(n){return n=t(n),this.put(new SVG.ConvolveMatrixEffect).attr({order:Math.sqrt(n.split(" ").length),kernelMatrix:n})},componentTransfer:function(n){var t=new SVG.ComponentTransferEffect,i;if(t.rgb=new SVG.Set,["r","g","b","a"].forEach(function(n){t[n]=(new SVG["Func"+n.toUpperCase()]).attr("type","identity");t.rgb.add(t[n]);t.node.appendChild(t[n].node)}),n){n.rgb&&(["r","g","b"].forEach(function(i){t[i].attr(n.rgb)}),delete n.rgb);for(i in n)t[i].attr(n[i])}return this.put(t)},composite:function(n,t,i){return this.put(new SVG.CompositeEffect).attr({"in":n,in2:t,operator:i})},flood:function(n){return this.put(new SVG.FloodEffect).attr({"flood-color":n})},offset:function(n,t){return this.put(new SVG.OffsetEffect).attr({dx:n,dy:t})},image:function(n){return this.put(new SVG.ImageEffect).attr("href",n,SVG.xlink)},merge:function(){},gaussianBlur:function(){return this.put(new SVG.GaussianBlurEffect).attr("stdDeviation",i(Array.prototype.slice.call(arguments)))},toString:function(){return"url(#"+this.attr("id")+")"}});SVG.extend(SVG.Defs,{filter:function(n){var t=this.put(new SVG.Filter);return typeof n=="function"&&n.call(t,t),t}});SVG.extend(SVG.Container,{filter:function(n){return this.defs().filter(n)}});SVG.extend(SVG.Element,SVG.G,SVG.Nested,{filter:function(n){return this.filterer=n instanceof SVG.Element?n:this.doc().filter(n),this.attr("filter",this.filterer),this.filterer},unfilter:function(n){return this.filterer&&n===!0&&this.filterer.remove(),delete this.filterer,this.attr("filter",null)}});SVG.Effect=function(){};SVG.Effect.prototype=new SVG.Element;SVG.extend(SVG.Effect,{"in":function(n){return this.attr("in",n)},result:function(){return this.attr("id")+"Out"},toString:function(){return this.result()}});var n=["blend","colorMatrix","componentTransfer","composite","convolveMatrix","diffuseLighting","displacementMap","flood","gaussianBlur","image","merge","morphology","offset","specularLighting","tile","turbulence","distantLight","pointLight","spotLight"];n.forEach(function(t){var i=t.charAt(0).toUpperCase()+t.slice(1);SVG[i+"Effect"]=function(){this.constructor.call(this,SVG.create("fe"+i))};SVG[i+"Effect"].prototype=["componentTransfer"].indexOf(i)>-1?new SVG.Parent:new SVG.Effect;n.forEach(function(n){SVG[i+"Effect"].prototype[n]=function(){return this.parent[n].apply(this.parent,arguments).in(this)}})});["r","g","b","a"].forEach(function(n){SVG["Func"+n.toUpperCase()]=function(){this.constructor.call(this,SVG.create("feFunc"+n.toUpperCase()))};SVG["Func"+n.toUpperCase()].prototype=new SVG.Element});SVG.extend(SVG.FloodEffect,{});SVG.filter={sepiatone:[.343,.669,.119,0,0,.249,.626,.13,0,0,.172,.334,.111,0,0,0,0,0,1,0]}}.call(this),function(){function n(t,i,r,u,f){for(var a,e,h,o,s,y,p,c,l=0,v=t.length;l<v;l++){o=t[l];s={};p=[];e=null;h=o.nodeName.toLowerCase();s=SVG.parse.attr(o);switch(h){case"rect":case"circle":case"ellipse":e=i[h](0,0);break;case"line":e=i.line(0,0,0,0);break;case"text":if(o.childNodes.length<2)e=i[h](o.textContent);else for(e=null,a=0;a<o.childNodes.length;a++)(c=o.childNodes[a],c.nodeName.toLowerCase()!="#text")&&c.nodeName.toLowerCase()=="tspan"&&(c.textContent=c.textContent.trim().replace(/\n/g," "," ").match(/[\S]+(\s)*/g).join(" "),e===null?e=i[h](c.textContent):e.tspan(c.textContent).attr(SVG.parse.attr(c)));break;case"path":e=i.path(s.d);break;case"polygon":case"polyline":e=i[h](s.points);break;case"image":e=i.image(s["xlink:href"]);break;case"g":case"svg":e=i[h=="g"?"group":"nested"]();n(o.childNodes,e,r+1,u,f);break;case"defs":n(o.childNodes,i.defs(),r+1,u,f);break;case"use":e=i.use();break;case"clippath":case"mask":e=i[h=="mask"?"mask":"clip"]();n(o.childNodes,e,r+1,u,f);break;case"lineargradient":case"radialgradient":e=i.defs().gradient(h.split("gradient")[0],function(n){for(var t=0;t<o.childNodes.length;t++)o.childNodes[t].nodeName.toLowerCase()!="#text"&&n.at({offset:0}).attr(SVG.parse.attr(o.childNodes[t])).style(o.childNodes[t].getAttribute("style"))});break;case"#comment":case"#text":case"metadata":case"desc":break;case"marker":e=i.defs().marker(o.getAttribute("markerWidth")||0,o.getAttribute("markerHeight")||0);n(o.childNodes,e,r+1,u,f);break;default:console.log("SVG Import got unexpected type "+h,o)}switch(h){case"circle":s.rx=s.r;s.ry=s.r;delete s.r}e&&(y=SVG.parse.transform(s.transform),delete s.transform,e.attr(s).transform(y),e.attr("id")&&u.add(e.attr("id"),e,r==0),h=="text"&&e.rebuild(),typeof f=="function"&&f.call(e,r))}return i}SVG.extend(SVG.Container,{svg:function(t,i){var r=document.createElement("div"),u=new SVG.ImportStore;return r.innerHTML=t.replace(/\n/,"").replace(/<([^\s]+)([^<]+?)\/>/g,"<$1$2><\/$1>"),n(r.childNodes,this,0,u,i),r=null,u}});SVG.ImportStore=function(){this._importStoreRoots=new SVG.Set;this._importStore={}};SVG.extend(SVG.ImportStore,{add:function(n,t,i){if(n){if(this._importStore[n]){var r=n;n+=Math.round(Math.random()*1e16);console.warn('Encountered duplicate id "'+r+'". Changed store key to "'+n+'".')}this._importStore[n]=t}return i===!0&&this._importStoreRoots.add(t),this},roots:function(n){return typeof n=="function"?(this._importStoreRoots.each(n),this):this._importStoreRoots.valueOf()},get:function(n){return this._importStore[n]},remove:function(){return this.roots(function(){this.remove()})}})}.call(this);
/*! svg.select.js - v1.0.0 - 2015-05-27
* https://github.com/Fuzzyma/svg.select.js
* Copyright (c) 2015 Ulrich-Matthias Schäfer; Licensed MIT */
(function(n){function t(n){this.el=n;this.parent=n.parent._parent(SVG.Nested)||n._parent(SVG.Doc);n.remember("_selectHandler",this);this.pointSelection={isSelected:!1};this.rectSelection={isSelected:!1}}t.prototype.init=function(t,i){var u=this.el.bbox(),r;this.options={};for(r in this.el.select.defaults)this.options[r]=this.el.select.defaults[r],i[r]!==n&&(this.options[r]=i[r]);this.nested=(this.nested||this.parent.nested()).size(u.width,u.height).transform(this.el.transform).move(u.x,u.y);this.options.deepSelect&&["line","polyline","polygon"].indexOf(this.el.type)!==-1?this.selectPoints(t):this.selectRect(t);this.observe();this.cleanup()};t.prototype.selectPoints=function(n){return(this.pointSelection.isSelected=n,this.pointSelection.set)?this:(this.pointSelection.set=this.parent.set(),this.drawCircles(),this)};t.prototype.getPointArray=function(){var n=this.el.bbox();return this.el.type==="line"?[[this.el.attr("x1")-n.x,this.el.attr("y1")]-n.y,[this.el.attr("x2")-n.x,this.el.attr("y2")]-n.y]:this.el.array.value.map(function(t){return[t[0]-n.x,t[1]-n.y]})};t.prototype.drawCircles=function(){for(var i=this,t=this.getPointArray(),n=0,r=t.length;n<r;++n)this.pointSelection.set.add(this.nested.circle(this.options.radius).center(t[n][0],t[n][1]).addClass(this.options.classPoints).addClass(this.options.classPoints+"_point").mousedown(function(n){return function(t){t=t||window.event;t.preventDefault?t.preventDefault():t.returnValue=!1;i.el.fire("point",{x:t.pageX,y:t.pageY,i:n,event:t})}}(n)))};t.prototype.updatePointSelection=function(){var n=this.getPointArray();this.pointSelection.set.each(function(t){(this.cx()!==n[t][0]||this.cy()!==n[t][1])&&this.center(n[t][0],n[t][1])})};t.prototype.updateRectSelection=function(){var n=this.el.bbox();this.rectSelection.set.get(0).attr({width:n.width,height:n.height});this.options.points&&(this.rectSelection.set.get(2).center(n.width,0),this.rectSelection.set.get(3).center(n.width,n.height),this.rectSelection.set.get(4).center(0,n.height),this.rectSelection.set.get(5).center(n.width/2,0),this.rectSelection.set.get(6).center(n.width,n.height/2),this.rectSelection.set.get(7).center(n.width/2,n.height),this.rectSelection.set.get(8).center(0,n.height/2));this.options.rotationPoint&&this.rectSelection.set.get(9).center(n.width/2,20)};t.prototype.selectRect=function(n){function i(n){return function(t){t=t||window.event;t.preventDefault?t.preventDefault():t.returnValue=!1;r.el.fire(n,{x:t.pageX,y:t.pageY})}}var r=this,t=this.el.bbox();this.rectSelection.isSelected=n;this.rectSelection.set=this.rectSelection.set||this.parent.set();this.rectSelection.set.get(0)||this.rectSelection.set.add(this.nested.rect(t.width,t.height).addClass(this.options.classRect));this.options.points&&!this.rectSelection.set.get(1)&&(this.rectSelection.set.add(this.nested.circle(this.options.radius).center(0,0).attr("class",this.options.classPoints+"_lt").mousedown(i("lt"))),this.rectSelection.set.add(this.nested.circle(this.options.radius).center(t.width,0).attr("class",this.options.classPoints+"_rt").mousedown(i("rt"))),this.rectSelection.set.add(this.nested.circle(this.options.radius).center(t.width,t.height).attr("class",this.options.classPoints+"_rb").mousedown(i("rb"))),this.rectSelection.set.add(this.nested.circle(this.options.radius).center(0,t.height).attr("class",this.options.classPoints+"_lb").mousedown(i("lb"))),this.rectSelection.set.add(this.nested.circle(this.options.radius).center(t.width/2,0).attr("class",this.options.classPoints+"_t").mousedown(i("t"))),this.rectSelection.set.add(this.nested.circle(this.options.radius).center(t.width,t.height/2).attr("class",this.options.classPoints+"_r").mousedown(i("r"))),this.rectSelection.set.add(this.nested.circle(this.options.radius).center(t.width/2,t.height).attr("class",this.options.classPoints+"_b").mousedown(i("b"))),this.rectSelection.set.add(this.nested.circle(this.options.radius).center(0,t.height/2).attr("class",this.options.classPoints+"_l").mousedown(i("l"))),this.rectSelection.set.each(function(){this.addClass(r.options.classPoints)}));this.options.rotationPoint&&!this.rectSelection.set.get(9)&&this.rectSelection.set.add(this.nested.circle(this.options.radius).center(t.width/2,20).attr("class",this.options.classPoints+"_rot").mousedown(function(n){n=n||window.event;n.preventDefault?n.preventDefault():n.returnValue=!1;r.el.fire("rot",{x:n.pageX,y:n.pageY})}))};t.prototype.handler=function(){var n=this.el.bbox();this.nested.size(n.width,n.height).transform(this.el.transform()).move(n.x,n.y);this.rectSelection.isSelected&&this.updateRectSelection();this.pointSelection.isSelected&&this.updatePointSelection()};t.prototype.observe=function(){var n=this;if(MutationObserver)if(this.rectSelection.isSelected||this.pointSelection.isSelected)this.observerInst=this.observerInst||new MutationObserver(function(){n.handler()}),this.observerInst.observe(this.el.node,{attributes:!0});else try{this.observerInst.disconnect();delete this.observerInst}catch(t){}else if(this.el.off("DOMAttrModified.select"),this.rectSelection.isSelected||this.pointSelection.isSelected)this.el.on("DOMAttrModified.select",function(){n.handler()})};t.prototype.cleanup=function(){!this.rectSelection.isSelected&&this.rectSelection.set&&(this.rectSelection.set.each(function(){this.remove()}),this.rectSelection.set.clear(),delete this.rectSelection.set);!this.pointSelection.isSelected&&this.pointSelection.set&&(this.pointSelection.set.each(function(){this.remove()}),this.pointSelection.set.clear(),delete this.pointSelection.set);this.pointSelection.isSelected||this.rectSelection.isSelected||(this.nested.remove(),delete this.nested)};SVG.extend(SVG.Element,{select:function(i,r){typeof i=="object"&&(r=i,i=!0);var u=this.remember("_selectHandler")||new t(this);return u.init(i===n?!0:i,r||{}),this}});SVG.Element.prototype.select.defaults={points:!0,classRect:"svg_select_boundingRect",classPoints:"svg_select_points",radius:7,rotationPoint:!0,deepSelect:!1}}).call(this);
/*! svg.resize.js - v1.0.0 - 2015-06-08
* https://github.com/Fuzzyma/svg.resize.js
* Copyright (c) 2015 Ulrich-Matthias Schäfer; Licensed MIT */
(function(){function t(n){var t=0,i=0,r;for(("doc"in n)&&(r=n.bbox(),t=r.x,i=r.y,n=n.doc().parent);n.nodeName.toUpperCase()!=="BODY";)t+=n.offsetLeft,i+=n.offsetTop,n=n.offsetParent;return{x:t,y:i}}function n(n){n.remember("_resizeHandler",this);this.el=n;this.parameters={};this.lastUpdateCall=null}n.prototype.init=function(n){var t=this,i;if(this.stop(),n!=="stop"){this.options={};for(i in this.el.resize.defaults)this.options[i]=this.el.resize.defaults[i],typeof n[i]!="undefined"&&(this.options[i]=n[i]);this.el.on("lt.resize",function(n){t.resize(n||window.event)});this.el.on("rt.resize",function(n){t.resize(n||window.event)});this.el.on("rb.resize",function(n){t.resize(n||window.event)});this.el.on("lb.resize",function(n){t.resize(n||window.event)});this.el.on("t.resize",function(n){t.resize(n||window.event)});this.el.on("r.resize",function(n){t.resize(n||window.event)});this.el.on("b.resize",function(n){t.resize(n||window.event)});this.el.on("l.resize",function(n){t.resize(n||window.event)});this.el.on("rot.resize",function(n){t.resize(n||window.event)});this.el.on("point.resize",function(n){t.resize(n||window.event)});this.update()}};n.prototype.stop=function(){return this.el.off("lt.resize"),this.el.off("rt.resize"),this.el.off("rb.resize"),this.el.off("lb.resize"),this.el.off("t.resize"),this.el.off("r.resize"),this.el.off("b.resize"),this.el.off("l.resize"),this.el.off("rot.resize"),this.el.off("point.resize"),this};n.prototype.resize=function(n){var r=this,i;this.parameters={x:n.detail.x,y:n.detail.y,box:this.el.bbox(),rbox:this.el.rbox(),rotation:this.el.transform().rotation};n.detail.i!==undefined&&(i=this.el.type==="line"?[[this.el.attr("x1"),this.el.attr("y1")],[this.el.attr("x2"),this.el.attr("y2")]]:this.el.array.value,this.parameters.i=n.detail.i,this.parameters.pointCoords=[i[n.detail.i][0],i[n.detail.i][1]]);switch(n.type){case"lt":this.calc=function(n,t){var i=this.snapToGrid(n,t);this.parameters.box.width-i[0]>0&&this.parameters.box.height-i[1]>0&&this.el.move(this.parameters.box.x+i[0],this.parameters.box.y+i[1]).size(this.parameters.box.width-i[0],this.parameters.box.height-i[1])};break;case"rt":this.calc=function(n,t){var i=this.snapToGrid(n,t,2);this.parameters.box.width+i[0]>0&&this.parameters.box.height-i[1]>0&&this.el.move(this.parameters.box.x,this.parameters.box.y+i[1]).size(this.parameters.box.width+i[0],this.parameters.box.height-i[1])};break;case"rb":this.calc=function(n,t){var i=this.snapToGrid(n,t,0);this.parameters.box.width+i[0]>0&&this.parameters.box.height+i[1]>0&&this.el.move(this.parameters.box.x,this.parameters.box.y).size(this.parameters.box.width+i[0],this.parameters.box.height+i[1])};break;case"lb":this.calc=function(n,t){var i=this.snapToGrid(n,t,1);this.parameters.box.width-i[0]>0&&this.parameters.box.height+i[1]>0&&this.el.move(this.parameters.box.x+i[0],this.parameters.box.y).size(this.parameters.box.width-i[0],this.parameters.box.height+i[1])};break;case"t":this.calc=function(n,t){var i=this.snapToGrid(n,t,2);this.parameters.box.height-i[1]>0&&this.el.move(this.parameters.box.x,this.parameters.box.y+i[1]).height(this.parameters.box.height-i[1])};break;case"r":this.calc=function(n,t){var i=this.snapToGrid(n,t,0);this.parameters.box.width+i[0]>0&&this.el.move(this.parameters.box.x,this.parameters.box.y).width(this.parameters.box.width+i[0])};break;case"b":this.calc=function(n,t){var i=this.snapToGrid(n,t,0);this.parameters.box.height+i[1]>0&&this.el.move(this.parameters.box.x,this.parameters.box.y).height(this.parameters.box.height+i[1])};break;case"l":this.calc=function(n,t){var i=this.snapToGrid(n,t,1);this.parameters.box.width-i[0]>0&&this.el.move(this.parameters.box.x+i[0],this.parameters.box.y).width(this.parameters.box.width-i[0])};break;case"rot":this.calc=function(n,i){var u={x:n+this.parameters.x,y:i+this.parameters.y},r=t(this.el),e=Math.atan2(this.parameters.y-r.y-this.parameters.rbox.height/2,this.parameters.x-r.x-this.parameters.rbox.width/2),o=Math.atan2(u.y-r.y-this.parameters.rbox.height/2,u.x-r.x-this.parameters.rbox.width/2),f=(o-e)*180/Math.PI;this.el.center(this.parameters.rbox.cx-.5,this.parameters.rbox.cy-1).transform({rotation:this.parameters.rotation+f-f%this.options.snapToAngle,cx:this.parameters.rbox.cx,cy:this.parameters.rbox.cy})};break;case"point":this.calc=function(n,t){var i=this.snapToGrid(n,t,this.parameters.pointCoords[0],this.parameters.pointCoords[1]),r=this.el.type==="line"?[{x1:this.parameters.pointCoords[0]+i[0],y1:this.parameters.pointCoords[1]+i[1]},{x2:this.parameters.pointCoords[0]+i[0],y2:this.parameters.pointCoords[1]+i[1]}]:this.el.array.value;if(this.el.type==="line"){this.el.attr(r[this.parameters.i]);return}r[this.parameters.i][0]=this.parameters.pointCoords[0]+i[0];r[this.parameters.i][1]=this.parameters.pointCoords[1]+i[1];this.el.plot(r)}}SVG.on(window,"mousemove.resize",function(n){r.update(n||window.event)});SVG.on(window,"mouseup.resize",function(){r.done()})};n.prototype.update=function(n){if(!n){this.lastUpdateCall&&this.calc(this.lastUpdateCall[0],this.lastUpdateCall[1]);return}var t=n.pageX-this.parameters.x,i=n.pageY-this.parameters.y;this.lastUpdateCall=[t,i];this.calc(t,i)};n.prototype.done=function(){this.lastUpdateCall=null;SVG.off(window,"mousemove.resize");SVG.off(window,"mouseup.resize");this.el.fire("resizedone")};n.prototype.snapToGrid=function(n,t,i,r){var u;return r?u=[(i+n)%this.options.snapToGrid,(r+t)%this.options.snapToGrid]:(i=i==null?3:i,u=[(this.parameters.box.x+n+(i&1?0:this.parameters.box.width))%this.options.snapToGrid,(this.parameters.box.y+t+(i&2?0:this.parameters.box.height))%this.options.snapToGrid]),n-=(Math.abs(u[0])<this.options.snapToGrid/2?u[0]:u[0]-this.options.snapToGrid)+(u[0]<0?this.options.snapToGrid:0),t-=(Math.abs(u[1])<this.options.snapToGrid/2?u[1]:u[1]-this.options.snapToGrid)+(u[1]<0?this.options.snapToGrid:0),[n,t]};SVG.extend(SVG.Element,{resize:function(t){return(this.remember("_resizeHandler")||new n(this)).init(t||{}),this}});SVG.Element.prototype.resize.defaults={snapToAngle:.1,snapToGrid:1}}).call(this),function(){function t(t,i){var r,u={};t=t||{};i=i||{};for(r in n)u[r]=typeof i[r]=="number"?i[r]:typeof t[r]=="number"?t[r]:n[r];return u}var n={spikes:7,inner:50,outer:100,edges:7,radius:100};SVG.extend(SVG.Polyline,SVG.Polygon,{star:function(n){var i=this.bbox();return this.settings=t(this.settings,n),this.plot(SVG.shapes.star(this.settings).move(i.x,i.y))},ngon:function(n){var i=this.bbox();return this.settings=t(this.settings,n),this.plot(SVG.shapes.ngon(this.settings).move(i.x,i.y))}});SVG.extend(SVG.FX,{star:function(n){var i=this.bbox();return this.target.settings=t(this.target.settings,n),this.plot(SVG.shapes.star(this.target.settings).move(i.x,i.y))},ngon:function(n){var i=this.bbox();return this.target.settings=t(this.target.settings,n),this.plot(SVG.shapes.ngon(this.target.settings).move(i.x,i.y))}});SVG.shapes={star:function(t){for(var i,f,e,o=[],s=typeof t.spikes=="number"?t.spikes:n.spikes,h=typeof t.inner=="number"?t.inner:n.inner,r=typeof t.outer=="number"?t.outer:n.outer,c=360/s,u=0;u<s;u++)i=u*c+90,f=r+h*Math.cos(i*Math.PI/180),e=r+h*Math.sin(i*Math.PI/180),o.push([f,e]),i+=c/2,f=r+r*Math.cos(i*Math.PI/180),e=r+r*Math.sin(i*Math.PI/180),o.push([f,e]);return new SVG.PointArray(o)},ngon:function(t){for(var u,f,e,o=[],s=typeof t.edges=="number"?t.edges:n.edges,r=typeof t.radius=="number"?t.radius:n.radius,h=360/s,i=0;i<s;i++)u=i*h-90,f=r+r*Math.cos(u*Math.PI/180),e=r+r*Math.sin(u*Math.PI/180),o.push([f,e]);return new SVG.PointArray(o)}}}.call(this),function(){function n(n){for(var t in n)/fill|stroke|opacity/.test(t)||delete n[t];return n}SVG.extend(SVG.Shape,{toPath:function(t){var h,c,i,r,s,o,a=this.trans,f=this.bbox(),e=0,u=0,l;switch(this.type){case"rect":h=this.attr("width");c=this.attr("height");i=this.attr("rx");r=this.attr("ry");i<0&&(i=0);r<0&&(r=0);i=i||r;r=r||i;i>h/2&&(i=h/2);r>c/2&&(r=c/2);s=i&&r?["M"+i+" "+u,"H"+(h-i),"A"+i+" "+r+" 0 0 1 "+h+" "+r,"V"+(c-r),"A"+i+" "+r+" 0 0 1 "+(h-i)+" "+c,"H"+i,"A"+i+" "+r+" 0 0 1 "+e+" "+(c-r),"V"+r,"A"+i+" "+r+" 0 0 1 "+i+" "+u,"z"]:["M"+e+" "+u,"H"+h,"V"+c,"H"+e,"V"+u,"z"];e=this.attr("x");u=this.attr("y");break;case"circle":case"ellipse":i=this.type=="ellipse"?this.attr("rx"):this.attr("r");r=this.type=="ellipse"?this.attr("ry"):this.attr("r");s=["M"+i+" "+u,"A"+i+" "+r+" 0 0 1 "+i*2+" "+r,"A"+i+" "+r+" 0 0 1 "+i+" "+r*2,"A"+i+" "+r+" 0 0 1 "+e+" "+r,"A"+i+" "+r+" 0 0 1 "+i+" "+u,"z"];e=this.attr("cx")-i;u=this.attr("cy")-r;break;case"polygon":case"polyline":for(this.move(0,0),s=[],l=0;l<this.array.value.length;l++)s.push((l==0?"M":"L")+this.array.value[l][0]+" "+this.array.value[l][1]);this.type=="polygon"&&s.push("Z");this.move(f.x,f.y);e=f.x;u=f.y;break;case"line":this.move(0,0);s=["M"+this.attr("x1")+" "+this.attr("y1"),"L"+this.attr("x2")+" "+this.attr("y2")];this.move(f.x,f.y);e=f.x;u=f.y;break;case"path":o=this.clone();o.unbiased=!0;o.plot(this.attr("d"));e=f.x;u=f.y;break;default:console.log("SVG toPath got unsupported type "+this.type,this)}return Array.isArray(s)&&(o=this.parent.path(s.join(""),!0).move(e+a.x,u+a.y).attr(n(this.attr())),this.after(o)),this instanceof SVG.Shape&&o&&(o.data("topath-type",this.type).data("topath-id",this.attr("id")),t===!0?this.remove():o.original=this),o}});SVG.extend(SVG.Parent,{toPath:function(n){for(var i=[].slice.call(this.children()),t=i.length-1;t>=0;t--)typeof i[t].toPath=="function"&&i[t].toPath(sample,n);return this}})}.call(this);
//# sourceMappingURL=svg.min.js.map
