@{
    ViewBag.Title = "Welcome";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<link href="/content/welcome.css" rel="stylesheet" type="text/css" />
<div style="padding: 10px; overflow: auto; background: #FFFFFF;">
    <div class="navbar">
        <div class="navbar-l">
        </div>
        <div class="navbar-r">
        </div>
        <div class="navbar-icon">
            <img src="/content/icons/32X32/hire_me.gif" /></div>
        <div class="navbar-inner">
            <b><span id="labelusername"></span><span>，</span><span id="labelwelcome"></span><span>欢迎使用系统</span></b>
        </div>
    </div>
    <div class="withicon">
        <div class="icon">
            <img src="/content/images/index/time.gif" /></div>
        <span id="labelLastLoginTime"></span>
    </div>
    <div class="navline">
    </div>
    <div class="links">
    </div>
    <div class="l-clear">
    </div>
    <div class="button" onclick="addfavorite(loadMyFavorite)">
        <div class="button-l">
        </div>
        <div class="button-r">
        </div>
        <div class="button-icon">
            <img src="/content/skins/icons/add.gif" />
        </div>
        <span>增加快捷方式</span>
    </div>
    <div id="container">
    </div>
    <div class="navbar">
        <div class="navbar-l">
        </div>
        <div class="navbar-r">
        </div>
        <div class="navbar-icon">
            <img src="/content/icons/32X32/collaboration.gif" /></div>
        <div class="navbar-inner">
            <b>使用说明</b>
        </div>
    </div>
    <p style="margin: 10px;">
        您可以快速进行销售的查询,并用可自定义的图表进行生动的展现</p>
    <p style="margin: 10px;">
        也可以快速进行访问您常用的菜单，全部的菜单都在左侧。。。 也可把常用菜单加入上方的收藏</p>
    <div class="navline">
    </div>
    <div class="withicon">
        <div class="icon">
            <img src="/content/icons/32X32/communication.gif" /></div>
        <span><b>帮助员工更方便和美观的进行总结和报表的编写.</b></span>
    </div>
    <p class="p1">
        <b>特别说明</b>：此版本还处于开发,调试阶段,如有bug反馈或好的建议,请联系.</p>
</div>
<script type="text/javascript">
    $("div.link").live("mouseover", function () {
        $(this).addClass("linkover");

    }).live("mouseout", function () {
        $(this).removeClass("linkover");


    }).live('click', function (e) {
        var text = $("a", this).html();
        var url = $(this).attr("url");
        parent.f_addTab(null, text, url);
    });

    $("div.link .close").live("mouseover", function () {
        $(this).addClass("closeover");
    }).live("mouseout", function () {
        $(this).removeClass("closeover");
    }).live('click', function () {
        var id = $(this).parent().attr("id");

        LG.ajax({
            loading: '正在删除用户收藏中...',
            url: "/home/RemoveMyFavorite",
            data: { ID: id },
            success: function () {
                loadMyFavorite();
            },
            error: function (message) {
                LG.showError(message);
            }
        });

        return false;
    });


    var links = $(".links");



    function loadMyFavorite() {
        LG.ajax({
            loading: '正在加载用户收藏中...',
            url: "/home/GetMyFavorite",
            success: function (Favorite) {
                links.html("");
                $(Favorite).each(function (i, data) {
                    var item = $('<div class="link"><img src="" /><a href="javascript:void(0)"></a><div class="close"></div></div>');
                    $("img", item).attr("src", data.Icon);
                    $("a", item).html(data.Title);
                    item.attr("id", data.Id);
                    //item.attr("title", data.FavoriteContent || data.FavoriteTitle);
                    item.attr("url", data.Url);
                    links.append(item);
                });
            },
            error: function (message) {
                LG.showError(message);
            }
        });
    }

    var _addWin;
    function addfavorite(success) {
        var menusTree = {
            url: "/home/getmenu",
            idFieldName: 'MenuId',
            parentIDFieldName: 'MenuParentId',
            textFieldName: "Title",
            checkbox: false,
            iconFieldName: "Icon",
            nodeWidth: 220
        };

        if (_addWin) {
            _addWin.show();
        }
        else {
            _addWin = LG.showDialogForm({ fields: [
                 { display: "页面", name: "MyMenusMenuID", newline: true, labelWidth: 100, width: 220, space: 30, type: "select",
                     options: { tree: menusTree, valueField: "MenuId", textField: "Title", valueFieldID: "MenuId", selectBoxHeight: 300 },
                     validate: { required: true }
                 },

                 { display: "收藏备注", name: "Content", newline: true, labelWidth: 100, width: 220, space: 30, type: "textarea" }

            ], action: "/home/AddMyFavorite", success: success, width: 400, height: 200, title: "添加收藏"
            });
        }
    }

    function loadInfo() {

        $("#labelusername").html("@ESS.Framework.Common.CurrentUserInfo.CurrentUserName");

        var now = new Date(), hour = now.getHours();
        if (hour > 4 && hour < 6) { $("#labelwelcome").html("凌晨好！") }
        else if (hour < 9) { $("#labelwelcome").html("早上好！") }
        else if (hour < 12) { $("#labelwelcome").html("上午好！") }
        else if (hour < 14) { $("#labelwelcome").html("中午好！") }
        else if (hour < 17) { $("#labelwelcome").html("下午好！") }
        else if (hour < 19) { $("#labelwelcome").html("傍晚好！") }
        else if (hour < 22) { $("#labelwelcome").html("晚上好！") }
        else { $("#labelwelcome").html("夜深了，注意休息！") }

        var lastlogintime = "@ESS.Framework.Common.CurrentUserInfo.CurrentLastLoginTime" || "从不";
        $("#labelLastLoginTime").html("您上次的登录时间是：" + lastlogintime);
    }


    loadInfo();
    loadMyFavorite();
</script>
